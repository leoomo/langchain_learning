#!/usr/bin/env python3
"""
åˆ›å»ºç®€åŒ–çš„ä¸­å›½è¡Œæ”¿åŒºåˆ’æ•°æ®åº“
åŒ…å«çœã€å¸‚ã€å¿å„çº§è¡Œæ”¿åŒºåˆ’åŠå…¶åæ ‡ä¿¡æ¯
"""

import sqlite3
import json
from typing import Dict, List, Tuple

def create_admin_database():
    """åˆ›å»ºè¡Œæ”¿åŒºåˆ’æ•°æ®åº“"""

    # æ•°æ®åº“æ–‡ä»¶è·¯å¾„
    db_path = "data/admin_divisions.db"

    # è¿æ¥æ•°æ®åº“
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()

    # åˆ›å»ºregionsè¡¨
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS regions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            code TEXT UNIQUE NOT NULL,
            name TEXT NOT NULL,
            parent_code TEXT,
            level INTEGER NOT NULL,
            longitude REAL,
            latitude REAL,
            pinyin TEXT,
            aliases TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')

    # åˆ›å»ºç´¢å¼•
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_regions_name ON regions(name)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_regions_pinyin ON regions(pinyin)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_regions_parent_code ON regions(parent_code)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_regions_level ON regions(level)')
    cursor.execute('CREATE INDEX IF NOT EXISTS idx_regions_coordinates ON regions(longitude, latitude)')

    # è¡Œæ”¿åŒºåˆ’æ•°æ®
    admin_data = [
        # çœçº§è¡Œæ”¿åŒº
        ("110000", "åŒ—äº¬å¸‚", None, 1, 116.4074, 39.9042, "beijing", '["äº¬", "é¦–éƒ½", "ç‡•äº¬"]'),
        ("310000", "ä¸Šæµ·å¸‚", None, 1, 121.4737, 31.2304, "shanghai", '["æ²ª", "ç”³", "é­”éƒ½"]'),
        ("440000", "å¹¿ä¸œçœ", None, 1, 113.2804, 23.1252, "guangdong", '["ç²¤"]'),
        ("330000", "æµ™æ±Ÿçœ", None, 1, 120.1534, 30.2651, "zhejiang", '["æµ™"]'),
        ("510000", "å››å·çœ", None, 1, 104.0665, 30.5723, "sichuan", '["å·", "èœ€"]'),
        ("610000", "é™•è¥¿çœ", None, 1, 108.9542, 34.2656, "shaanxi", '["é™•", "ç§¦"]'),
        ("420000", "æ¹–åŒ—çœ", None, 1, 114.3416, 30.5467, "hubei", '["é„‚", "æ¥š"]'),
        ("320000", "æ±Ÿè‹çœ", None, 1, 118.7675, 32.0415, "jiangsu", '["è‹"]'),
        ("500000", "é‡åº†å¸‚", None, 1, 106.5516, 29.5630, "chongqing", '["æ¸", "å·´"]'),
        ("120000", "å¤©æ´¥å¸‚", None, 1, 117.1901, 39.1084, "tianjin", '["æ´¥"]'),
        ("370000", "å±±ä¸œçœ", None, 1, 117.0008, 36.6758, "shandong", '["é²", "é½é²"]'),
        ("210000", "è¾½å®çœ", None, 1, 123.4315, 41.8057, "liaoning", '["è¾½", "å¥‰"]'),
        ("350000", "ç¦å»ºçœ", None, 1, 119.3006, 26.0789, "fujian", '["é—½", "å…«é—½"]'),

        # åœ°çº§å¸‚
        ("440100", "å¹¿å·å¸‚", "440000", 2, 113.2644, 23.1291, "guangzhou", '["ç¾ŠåŸ", "èŠ±åŸ", "ç©—"]'),
        ("440300", "æ·±åœ³å¸‚", "440000", 2, 114.0579, 22.5431, "shenzhen", '["é¹åŸ", "æ·±"]'),
        ("330100", "æ­å·å¸‚", "330000", 2, 120.1551, 30.2741, "hangzhou", '["æ­", "æ­¦æ—", "é’±å¡˜"]'),
        ("510100", "æˆéƒ½å¸‚", "510000", 2, 104.0665, 30.5723, "chengdu", '["è“‰", "é”¦åŸ", "å¤©åºœ"]'),
        ("610100", "è¥¿å®‰å¸‚", "610000", 2, 108.9402, 34.3416, "xian", '["é•¿å®‰", "é•äº¬", "è¥¿äº¬"]'),
        ("420100", "æ­¦æ±‰å¸‚", "420000", 2, 114.3055, 30.5928, "wuhan", '["æ±ŸåŸ", "æ±Ÿå¤", "æ¥š"]'),
        ("320100", "å—äº¬å¸‚", "320000", 2, 118.7675, 32.0415, "nanjing", '["å®", "é‡‘é™µ", "å»ºåº·"]'),
        ("500100", "é‡åº†å¸‚ä¸»åŸåŒº", "500000", 2, 106.5516, 29.5630, "chongqing", '["æ¸", "å·´"]'),
        ("120100", "å¤©æ´¥å¸‚", "120000", 2, 117.1901, 39.1084, "tianjin", '["æ´¥", "æ´¥é—¨"]'),
        ("370100", "æµå—å¸‚", "370000", 2, 117.0008, 36.6758, "jinan", '["æ³‰åŸ", "é½å·", "å†ä¸‹"]'),
        ("370200", "é’å²›å¸‚", "370000", 2, 120.3826, 36.0671, "qingdao", '["å²›åŸ", "ç´å²›", "èƒ¶æ¾³"]'),
        ("210100", "æ²ˆé˜³å¸‚", "210000", 2, 123.4315, 41.8057, "shenyang", '["ç››äº¬", "å¥‰å¤©", "æ²ˆ"]'),
        ("210200", "å¤§è¿å¸‚", "210000", 2, 121.6186, 38.9140, "dalian", '["æ»¨åŸ", "æ˜Ÿæµ·", "è¿"]'),
        ("350100", "ç¦å·å¸‚", "350000", 2, 119.3063, 26.0745, "fuzhou", '["æ¦•åŸ", "å·¦æµ·", "ä¸‰å±±"]'),
        ("350200", "å¦é—¨å¸‚", "350000", 2, 118.1119, 24.4905, "xiamen", '["é¹­å²›", "å¦", "é—¨"]'),

        # å¿çº§è¡Œæ”¿åŒº
        ("440106", "å¤©æ²³åŒº", "440100", 3, 113.3611, 23.1247, "tianhe", '["å¤©æ²³"]'),
        ("440103", "è¶Šç§€åŒº", "440100", 3, 113.2665, 23.1289, "yuexiu", '["è¶Šç§€"]'),
        ("440304", "ç¦ç”°åŒº", "440300", 3, 114.0557, 22.5221, "futian", '["ç¦ç”°"]'),
        ("440303", "ç½—æ¹–åŒº", "440300", 3, 114.1313, 22.5484, "luohu", '["ç½—æ¹–"]'),
        ("330106", "è¥¿æ¹–åŒº", "330100", 3, 120.1551, 30.2741, "xihu", '["è¥¿æ¹–"]'),
        ("330102", "ä¸ŠåŸåŒº", "330100", 3, 120.1699, 30.2544, "shangcheng", '["ä¸ŠåŸ"]'),
        ("510104", "é”¦æ±ŸåŒº", "510100", 3, 104.0665, 30.5723, "jinjiang", '["é”¦æ±Ÿ"]'),
        ("510105", "é’ç¾ŠåŒº", "510100", 3, 104.0455, 30.6732, "qingyang", '["é’ç¾Š"]'),
        ("610102", "æ–°åŸåŒº", "610100", 3, 108.9402, 34.3416, "xincheng", '["æ–°åŸ"]'),
        ("610103", "ç¢‘æ—åŒº", "610100", 3, 108.9342, 34.2468, "beilin", '["ç¢‘æ—"]'),
        ("420102", "æ±Ÿå²¸åŒº", "420100", 3, 114.3055, 30.5928, "jiangan", '["æ±Ÿå²¸"]'),
        ("420103", "æ±Ÿæ±‰åŒº", "420100", 3, 114.2709, 30.6015, "jianghan", '["æ±Ÿæ±‰"]'),
        ("320102", "ç„æ­¦åŒº", "320100", 3, 118.7675, 32.0415, "xuanwu", '["ç„æ­¦"]'),
        ("320104", "ç§¦æ·®åŒº", "320100", 3, 118.7989, 32.0112, "qinhuai", '["ç§¦æ·®"]'),
        ("120101", "å’Œå¹³åŒº", "120100", 3, 117.1901, 39.1084, "heping", '["å’Œå¹³"]'),
        ("370102", "å†ä¸‹åŒº", "370100", 3, 117.0008, 36.6758, "lixia", '["å†ä¸‹"]'),
        ("370202", "å¸‚å—åŒº", "370200", 3, 120.3826, 36.0671, "shinan", '["å¸‚å—"]'),
        ("210102", "å’Œå¹³åŒº", "210100", 3, 123.4315, 41.8057, "heping_sy", '["å’Œå¹³"]'),
        ("210202", "ä¸­å±±åŒº", "210200", 3, 121.6186, 38.9140, "zhongshan", '["ä¸­å±±"]'),
        ("350102", "é¼“æ¥¼åŒº", "350100", 3, 119.3063, 26.0745, "gulou", '["é¼“æ¥¼"]'),
        ("350203", "æ€æ˜åŒº", "350200", 3, 118.1119, 24.4905, "siming", '["æ€æ˜"]'),

        # ä¹¡é•‡çº§è¡Œæ”¿åŒºï¼ˆæ–°å¢ï¼‰
        ("440111", "æ²³æ¡¥é•‡", "440100", 4, 113.2804, 23.1252, "heqiao", '["æ²³æ¡¥é•‡"]'),
        ("440112", "æ²™æ²³é•‡", "440100", 4, 113.2904, 23.1352, "shahe", '["æ²™æ²³é•‡"]'),
        ("440113", "çŸ³æ¥¼é•‡", "440100", 4, 113.3004, 23.1452, "shilou", '["çŸ³æ¥¼é•‡"]'),
        ("440114", "æ–°å¡˜é•‡", "440100", 4, 113.3104, 23.1552, "xintang", '["æ–°å¡˜é•‡"]'),
        ("440115", "å¤ªå¹³é•‡", "440100", 4, 113.3204, 23.1652, "taiping", '["å¤ªå¹³é•‡"]'),
        ("440116", "ä¸­æ–°é•‡", "440100", 4, 113.3304, 23.1752, "zhongxin", '["ä¸­æ–°é•‡"]'),
        ("440117", "æ°¸å®é•‡", "440100", 4, 113.3404, 23.1852, "yongning", '["æ°¸å®é•‡']'),
        ("440118", "ä»™æ‘é•‡", "440100", 4, 113.3504, 23.1952, "xiancun", '["ä»™æ‘é•‡"]'),

        # æ–°å¢æ›´å¤šåŸå¸‚å’Œåœ°åŒº
        ("430000", "æ¹–å—çœ", None, 1, 112.9836, 28.1122, "hunan", '["æ¹˜", "æ½‡æ¹˜"]'),
        ("410000", "æ²³å—çœ", None, 1, 113.6687, 34.7466, "henan", '["è±«", "ä¸­åŸ"]'),
        ("340000", "å®‰å¾½çœ", None, 1, 117.2272, 31.8206, "anhui", '["çš–", "æ±Ÿæ·®"]'),
        ("360000", "æ±Ÿè¥¿çœ", None, 1, 115.8922, 28.6765, "jiangxi", '["èµ£", "æ±Ÿå³"]'),
        ("520000", "è´µå·çœ", None, 1, 106.7136, 26.5783, "guizhou", '["é»”", "è´µ"]'),
        ("530000", "äº‘å—çœ", None, 1, 102.7103, 25.0446, "yunnan", '["æ»‡", "äº‘"]'),

        # æ›´å¤šåœ°çº§å¸‚
        ("430100", "é•¿æ²™å¸‚", "430000", 2, 112.9825, 28.1959, "changsha", '["æ˜ŸåŸ", "é•¿æ²™", "æ¹˜"]'),
        ("410100", "éƒ‘å·å¸‚", "410000", 2, 113.6254, 34.7466, "zhengzhou", '["å•†éƒ½", "ç»¿åŸ", "éƒ‘å·"]'),
        ("340100", "åˆè‚¥å¸‚", "340000", 2, 117.2272, 31.8206, "hefei", '["åºå·", "åˆè‚¥", "çš–"]'),
        ("360100", "å—æ˜Œå¸‚", "360000", 2, 115.8922, 28.6765, "nanchang", '["æ´ªéƒ½", "å—æ˜Œ", "èµ£"]'),
        ("520100", "è´µé˜³å¸‚", "520000", 2, 106.7136, 26.5783, "guiyang", '["æ—åŸ", "ç­‘åŸ", "è´µé˜³"]'),
        ("530100", "æ˜†æ˜å¸‚", "530000", 2, 102.7103, 25.0446, "kunming", '["æ˜¥åŸ", "æ˜†æ˜", "æ»‡"]'),

        # ä¸»è¦å¿çº§å¸‚å’Œå¿
        ("430181", "æµé˜³å¸‚", "430100", 3, 113.6431, 28.1406, "liuyang", '["æµé˜³"]'),
        ("430182", "å®ä¹¡å¸‚", "430100", 3, 112.5536, 28.2536, "ningxiang", '["å®ä¹¡"]'),
        ("410181", "å·©ä¹‰å¸‚", "410100", 3, 113.0223, 34.7489, "gongyi", '["å·©ä¹‰"]'),
        ("410182", "è¥é˜³å¸‚", "410100", 3, 113.3835, 34.7876, "xingyang", '["è¥é˜³"]'),
        ("340181", "å·¢æ¹–å¸‚", "340100", 3, 117.8741, 31.6248, "chaohu", '["å·¢æ¹–"]'),
        ("340182", "åºæ±Ÿå¿", "340100", 3, 117.2897, 31.2515, "lujiang", '["åºæ±Ÿ"]'),
        ("360181", "å—æ˜Œå¿", "360100", 3, 115.9432, 28.5456, "nanchangxian", '["å—æ˜Œå¿"]'),
        ("360182", "æ–°å»ºåŒº", "360100", 3, 115.8152, 28.6927, "xinjian", '["æ–°å»º"]'),
        ("520181", "æ¸…é•‡å¸‚", "520100", 3, 106.4686, 26.5527, "qingzhen", '["æ¸…é•‡"]'),
        ("530181", "å®‰å®å¸‚", "530100", 3, 102.4891, 24.9156, "anning", '["å®‰å®"]'),
    ]

    # æ’å…¥æ•°æ®
    insert_sql = '''
        INSERT OR REPLACE INTO regions
        (code, name, parent_code, level, longitude, latitude, pinyin, aliases)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    '''

    cursor.executemany(insert_sql, admin_data)

    # æäº¤äº‹åŠ¡
    conn.commit()

    # æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯
    cursor.execute("SELECT level, COUNT(*) FROM regions GROUP BY level ORDER BY level")
    stats = cursor.fetchall()

    print("ğŸ“Š è¡Œæ”¿åŒºåˆ’æ•°æ®åº“åˆ›å»ºå®Œæˆï¼")
    print("=" * 50)
    print("ğŸ“ˆ æ•°æ®ç»Ÿè®¡:")
    for level, count in stats:
        level_name = {1: "çœçº§", 2: "åœ°çº§", 3: "å¿çº§"}.get(level, f"çº§åˆ«{level}")
        print(f"   {level_name}è¡Œæ”¿åŒºåˆ’: {count}ä¸ª")

    cursor.execute("SELECT COUNT(*) FROM regions")
    total_count = cursor.fetchone()[0]
    print(f"   æ€»è®¡: {total_count}ä¸ªè¡Œæ”¿åŒºåˆ’")

    # æµ‹è¯•æŸ¥è¯¢
    print("\nğŸ” æµ‹è¯•æŸ¥è¯¢:")
    test_queries = ["åŒ—äº¬å¸‚", "ä¸Šæµ·å¸‚", "å¹¿å·å¸‚", "æ·±åœ³å¸‚", "æœé˜³åŒº", "å¤©æ²³åŒº"]
    for query in test_queries:
        cursor.execute("SELECT name, longitude, latitude FROM regions WHERE name LIKE ? LIMIT 1", (f"%{query}%",))
        result = cursor.fetchone()
        if result:
            print(f"   âœ… {query}: {result[0]} ({result[1]:.4f}, {result[2]:.4f})")
        else:
            print(f"   âŒ {query}: æœªæ‰¾åˆ°")

    # å…³é—­è¿æ¥
    conn.close()

    print(f"\nğŸ’¾ æ•°æ®åº“æ–‡ä»¶å·²ä¿å­˜åˆ°: {db_path}")
    print("ğŸ‰ å¯ä»¥å¼€å§‹ä½¿ç”¨ CityCoordinateDB ç±»è¿›è¡ŒæŸ¥è¯¢ï¼")

    return db_path

if __name__ == "__main__":
    create_admin_database()