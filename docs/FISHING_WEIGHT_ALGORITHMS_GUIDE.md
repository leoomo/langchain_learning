# é’“é±¼æƒé‡ç®—æ³•æŒ‡å—

*åŸºäºç§‘å­¦ç ”ç©¶å’Œæ°”è±¡å­¦çš„ä¸“ä¸šé’“é±¼æ¨èè¯„åˆ†ç³»ç»Ÿ*

## ğŸ“– ç›®å½•

- [1. æ‰§è¡Œæ‘˜è¦](#1-æ‰§è¡Œæ‘˜è¦)
- [2. å½“å‰ç³»ç»Ÿåˆ†æ](#2-å½“å‰ç³»ç»Ÿåˆ†æ)
- [3. ä¼˜åŒ–ç³»ç»Ÿè®¾è®¡](#3-ä¼˜åŒ–ç³»ç»Ÿè®¾è®¡)
- [4. æ•°å­¦å…¬å¼è¯¦è§£](#4-æ•°å­¦å…¬å¼è¯¦è§£)
- [5. å®ç°æŒ‡å—](#5-å®ç°æŒ‡å—)
- [6. ä»£ç ç¤ºä¾‹](#6-ä»£ç ç¤ºä¾‹)
- [7. å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
- [8. æ€§èƒ½å¯¹æ¯”](#8-æ€§èƒ½å¯¹æ¯”)
- [é™„å½•ï¼šç§‘å­¦ä¾æ®](#é™„å½•ç§‘å­¦ä¾æ®)

---

## 1. æ‰§è¡Œæ‘˜è¦

### é—®é¢˜æ¦‚è¿°

å½“å‰é’“é±¼æ¨èç³»ç»Ÿå­˜åœ¨**è¯„åˆ†ç›¸åŒ**çš„é—®é¢˜ï¼š

```
ä¸Šåˆ: 19.8Â°C é˜´å¤© é£åŠ›4.4km/h â†’ 86åˆ†
ä¸­åˆ: 23.7Â°C é˜´å¤© é£åŠ›2.8km/h â†’ 86åˆ†
ä¸‹åˆ: 23.1Â°C é˜´å¤© é£åŠ›1.1km/h â†’ 86åˆ†
```

ä¸‰ä¸ªä¸åŒçš„æ—¶é—´æ®µè·å¾—å®Œå…¨ç›¸åŒçš„86åˆ†ï¼Œç”¨æˆ·éš¾ä»¥åšå‡ºæœ€ä¼˜é€‰æ‹©ã€‚

### è§£å†³æ–¹æ¡ˆ

å®æ–½**ç²¾ç»†è¯„åˆ†ç³»ç»Ÿï¼ˆæ–¹æ¡ˆAï¼‰**ï¼Œå°†æƒé‡å› å­ä»3ä¸ªæ‰©å±•åˆ°7ä¸ªï¼š

| æƒé‡å› å­ | å½“å‰æƒé‡ | ä¼˜åŒ–æƒé‡ | ç§‘å­¦ä¾æ® |
|----------|----------|----------|----------|
| æ¸©åº¦ | 40% | 25% | åŸºç¡€é‡è¦ï¼Œä½†ä¸æ˜¯å”¯ä¸€å› ç´  |
| å¤©æ°” | 35% | 20% | é‡è¦ï¼Œä½†æƒé‡è¿‡é«˜ |
| é£åŠ› | 25% | 15% | é‡è¦ï¼Œéœ€è¦ç¨³å®šæ€§åˆ†æ |
| **æ°”å‹** | 0% | 15% | æ–°å¢ï¼šé±¼ç±»æ´»åŠ¨å…³é”®å› å­ |
| **æ¹¿åº¦** | 0% | 10% | æ–°å¢ï¼šåæ˜ æ°”å‹ç³»ç»Ÿ |
| **å­£èŠ‚æ€§** | 0% | 5% | æ–°å¢ï¼šé±¼ç±»ç”Ÿç‰©å­¦è§„å¾‹ |
| **æœˆç›¸** | 0% | 5% | æ–°å¢ï¼šå¤©æ–‡å½±å“å› å­ |

### é¢„æœŸæ•ˆæœ

**ä¼˜åŒ–åè¯„åˆ†ç¤ºä¾‹**ï¼š
```
ä¸Šåˆ: 19.8Â°C é˜´å¤© é£åŠ›4.4km/h æ°”å‹1013hPa æ¹¿åº¦65% â†’ 82åˆ†
ä¸­åˆ: 23.7Â°C é˜´å¤© é£åŠ›2.8km/h æ°”å‹1011hPa æ¹¿åº¦68% â†’ 91åˆ†
ä¸‹åˆ: 23.1Â°C é˜´å¤© é£åŠ›1.1km/h æ°”å‹1009hPa æ¹¿åº¦70% â†’ 94åˆ†
```

**æ•ˆæœæå‡**ï¼š
- âœ… æ˜æ˜¾åŒºåˆ†åº¦ï¼ˆ>5åˆ†å·®å¼‚ï¼‰
- âœ… ä¸“ä¸šå¯ä¿¡åº¦æå‡
- âœ… è¯¦ç»†çš„å¤©æ°”èƒŒæ™¯ä¿¡æ¯
- âœ… åŸºäºç§‘å­¦ç ”ç©¶çš„è¯„åˆ†ä½“ç³»

---

## 2. å½“å‰ç³»ç»Ÿåˆ†æ

### 2.1 ç³»ç»Ÿæ¶æ„

å½“å‰ç³»ç»Ÿä½¿ç”¨**ç®€å•3å› å­åŠ æƒè¯„åˆ†**ï¼š

```python
# å½“å‰è¯„åˆ†å…¬å¼ (tools/fishing_analyzer.py)
overall_score = (
    temperature_score * 0.4 +      # æ¸©åº¦æƒé‡ 40%
    weather_score * 0.35 +         # å¤©æ°”æƒé‡ 35%
    wind_score * 0.25              # é£åŠ›æƒé‡ 25%
)
```

### 2.2 å„å› å­è¯¦è§£

#### 2.2.1 æ¸©åº¦è¯„åˆ†ç®—æ³•

**ç§‘å­¦ä¾æ®**ï¼šé±¼ç±»æ˜¯å˜æ¸©åŠ¨ç‰©ï¼Œæ¸©åº¦ç›´æ¥å½±å“å…¶ä»£è°¢å’Œæ´»åŠ¨èƒ½åŠ›ã€‚

**æœ€ä½³æ¸©åº¦èŒƒå›´**ï¼š15-25Â°C

```python
def calculate_temperature_score(self, temperature: float) -> float:
    """
    è®¡ç®—æ¸©åº¦è¯„åˆ†

    Args:
        temperature: æ¸©åº¦ (Â°C)

    Returns:
        æ¸©åº¦è¯„åˆ† (0-100)
    """
    min_temp, max_temp = self.optimal_temp_range  # 15-25Â°C

    if min_temp <= temperature <= max_temp:
        # åœ¨æœ€ä½³èŒƒå›´å†…ï¼Œç»™æ»¡åˆ†
        return 100.0
    elif temperature < min_temp:
        # ä½äºæœ€ä½³èŒƒå›´ï¼Œçº¿æ€§é€’å‡
        if temperature < 0:
            return 0.0
        ratio = temperature / min_temp
        return max(0.0, ratio * 80)  # æœ€ä½0åˆ†ï¼Œæœ€é«˜80åˆ†
    else:
        # é«˜äºæœ€ä½³èŒƒå›´ï¼Œçº¿æ€§é€’å‡
        if temperature > 35:
            return 0.0
        excess = temperature - max_temp
        ratio = max(0, 1 - excess / 10)  # è¶…è¿‡10åº¦ç»™0åˆ†
        return ratio * 80  # æœ€ä½0åˆ†ï¼Œæœ€é«˜80åˆ†
```

**è¯„åˆ†ç‰¹å¾**ï¼š
- æœ€ä½³èŒƒå›´ï¼š100åˆ†
- è½»å¾®åç¦»ï¼š80-95åˆ†
- ä¸¥é‡åç¦»ï¼š0-60åˆ†
- æç«¯æ¡ä»¶ï¼š0åˆ†

#### 2.2.2 å¤©æ°”è¯„åˆ†ç®—æ³•

**ç§‘å­¦ä¾æ®**ï¼šå¤©æ°”çŠ¶å†µç›´æ¥å½±å“é±¼ç±»çš„æ°´é¢æ´»åŠ¨å’Œè§…é£Ÿè¡Œä¸ºã€‚

```python
def calculate_weather_score(self, condition: str) -> float:
    """
    è®¡ç®—å¤©æ°”è¯„åˆ†

    Args:
        condition: å¤©æ°”çŠ¶å†µ

    Returns:
        å¤©æ°”è¯„åˆ† (0-100)
    """
    condition = condition.lower()

    # æœ€ä½³å¤©æ°” (å¤šäº‘ã€é˜´å¤© - å…‰çº¿é€‚ä¸­ï¼Œé±¼ç±»æ´»è·ƒ)
    best_weather = ["å¤šäº‘", "é˜´"]
    for weather in best_weather:
        if weather in condition:
            return 100.0

    # è‰¯å¥½å¤©æ°” (æ™´ã€å°é›¨ - æ¡ä»¶å°šå¯)
    good_weather = ["æ™´", "å°é›¨"]
    for weather in good_weather:
        if weather in condition:
            return 85.0

    # ä¸€èˆ¬å¤©æ°” (ä¸­é›¨ - æœ‰æŒ‘æˆ˜ä½†å¯æ¥å—)
    fair_weather = ["ä¸­é›¨"]
    for weather in fair_weather:
        if weather in condition:
            return 50.0

    # è¾ƒå·®å¤©æ°” (å¤§é›¨ã€æš´é›¨ã€é›·é˜µé›¨ - å›°éš¾å¾ˆå¤§)
    poor_weather = ["å¤§é›¨", "æš´é›¨", "é›·é˜µé›¨"]
    for weather in poor_weather:
        if weather in condition:
            return 20.0

    # æå·®å¤©æ°” (é›ªã€å†°é›¹ã€é›¾ã€éœ¾ - å‡ ä¹ä¸å¯èƒ½é’“é±¼)
    terrible_weather = ["é›ª", "å†°é›¹", "é›¾", "éœ¾"]
    for weather in terrible_weather:
        if weather in condition:
            return 10.0

    return 50.0  # é»˜è®¤åˆ†æ•°
```

**å¤©æ°”è¯„åˆ†ç­‰çº§**ï¼š
- 100åˆ†ï¼šå¤šäº‘ã€é˜´å¤©ï¼ˆæœ€ä½³ï¼‰
- 85åˆ†ï¼šæ™´ã€å°é›¨ï¼ˆè‰¯å¥½ï¼‰
- 50åˆ†ï¼šä¸­é›¨ï¼ˆä¸€èˆ¬ï¼‰
- 20åˆ†ï¼šå¤§é›¨ã€æš´é›¨ã€é›·é˜µé›¨ï¼ˆè¾ƒå·®ï¼‰
- 10åˆ†ï¼šé›ªã€å†°é›¹ã€é›¾ã€éœ¾ï¼ˆæå·®ï¼‰

#### 2.2.3 é£åŠ›è¯„åˆ†ç®—æ³•

**ç§‘å­¦ä¾æ®**ï¼šé£é€Ÿå½±å“æ°´é¢æ‰°åŠ¨ã€æ°§æ°”æº¶è§£åº¦ï¼Œä»¥åŠæŠ•é’“çš„å‡†ç¡®æ€§ã€‚

```python
def calculate_wind_score(self, wind_speed: float) -> float:
    """
    è®¡ç®—é£åŠ›è¯„åˆ†

    Args:
        wind_speed: é£é€Ÿ (km/h)

    Returns:
        é£åŠ›è¯„åˆ† (0-100)
    """
    min_wind, max_wind = self.optimal_wind_speed  # 0-15 km/h

    if min_wind <= wind_speed <= max_wind:
        # åœ¨æœ€ä½³èŒƒå›´å†…
        return 100.0
    elif wind_speed < min_wind:
        # é£å¤ªå°ï¼Œå½±å“é’“é¥µä¼ æ’­
        return 85.0
    else:
        # é£å¤ªå¤§ï¼Œå½±å“é’“é±¼
        if wind_speed > 30:
            return 10.0
        excess = wind_speed - max_wind
        ratio = max(0, 1 - excess / 15)  # è¶…è¿‡15km/hå¼€å§‹å¿«é€Ÿé€’å‡
        return ratio * 80  # æœ€ä½0åˆ†ï¼Œæœ€é«˜80åˆ†
```

**é£é€Ÿè¯„åˆ†æ ‡å‡†**ï¼š
- 0-15 km/hï¼š100åˆ†ï¼ˆç†æƒ³é£åŠ›ï¼‰
- < 0 km/hï¼š85åˆ†ï¼ˆè¿‡é™ï¼‰
- 15-30 km/hï¼š80-100åˆ†ï¼ˆçº¿æ€§é€’å‡ï¼‰
- > 30 km/hï¼š10åˆ†ï¼ˆä¸å®œé’“é±¼ï¼‰

### 2.3 å½“å‰ç³»ç»Ÿå±€é™æ€§

#### 2.3.1 æƒé‡åˆ†é…é—®é¢˜

- **æ¸©åº¦æƒé‡è¿‡é«˜ï¼ˆ40%ï¼‰**ï¼šè¿‡åº¦ä¾èµ–å•ä¸€å› å­
- **å¤©æ°”æƒé‡åé«˜ï¼ˆ35%ï¼‰**ï¼šç›¸å¯¹é‡è¦æ€§è¢«é«˜ä¼°
- **é£åŠ›æƒé‡é€‚ä¸­ï¼ˆ25%ï¼‰**ï¼šä½†ç¼ºä¹ç¨³å®šæ€§åˆ†æ

#### 2.3.2 è¯„åˆ†ç»´åº¦ä¸è¶³

**ç¼ºå¤±çš„å…³é”®å› å­**ï¼š
- **æ°”å‹**ï¼šå½±å“é±¼ç±»æ´»åŠ¨çš„é‡è¦æ°”è±¡å› å­
- **æ¹¿åº¦**ï¼šåæ˜ æ°”å‹ç³»ç»Ÿå˜åŒ–çš„é—´æ¥æŒ‡æ ‡
- **å­£èŠ‚æ€§**ï¼šé±¼ç±»ç”Ÿç‰©å­¦è§„å¾‹
- **æœˆç›¸**ï¼šå¤©æ–‡å¼•åŠ›å½±å“
- **æ¸©åº¦å˜åŒ–è¶‹åŠ¿**ï¼šåŠ¨æ€å˜åŒ–vsé™æ€å€¼
- **é£é€Ÿç¨³å®šæ€§**ï¼šç¨³å®šæ€§vsç»å¯¹å€¼

#### 2.3.3 ç²¾åº¦é—®é¢˜

**"86åˆ†é—®é¢˜"åˆ†æ**ï¼š
- å¤šä¸ªä¸åŒæ¡ä»¶è·å¾—ç›¸åŒè¯„åˆ†
- æ— æ³•ä½“ç°ç»†å¾®çš„ç¯å¢ƒä¼˜åŠ¿å·®å¼‚
- ç”¨æˆ·éš¾ä»¥åšå‡ºæœ€ä¼˜å†³ç­–
- ç¼ºä¹ä¸“ä¸šæ°”è±¡ä¿¡æ¯æ”¯æŒ

---

## 3. ä¼˜åŒ–ç³»ç»Ÿè®¾è®¡

### 3.1 è®¾è®¡åŸåˆ™

1. **ä¸“ä¸šå¯¼å‘**ï¼šåŸºäºé’“é±¼ç§‘å­¦ç ”ç©¶å’Œå®é™…ç»éªŒ
2. **æ•°æ®é©±åŠ¨**ï¼šå……åˆ†åˆ©ç”¨ç°æœ‰å½©äº‘å¤©æ°”APIæ•°æ®
3. **ç²¾ç»†è¯„åˆ†**ï¼šæé«˜è¯„åˆ†ç²¾åº¦å’ŒåŒºåˆ†åº¦
4. **ç§‘å­¦ä¾æ®**ï¼šæ¯ä¸ªæƒé‡éƒ½æœ‰æ˜ç¡®çš„ç§‘å­¦åŸºç¡€
5. **å‘åå…¼å®¹**ï¼šä¿æŒç°æœ‰æ¥å£ç¨³å®šæ€§

### 3.2 æ–°æƒé‡åˆ†é…

```python
# ä¼˜åŒ–åçš„è¯„åˆ†å…¬å¼
overall_score = (
    temperature_score * 0.25 +      # æ¸©åº¦ 25% (é™ä½)
    weather_score * 0.20 +          # å¤©æ°” 20% (é™ä½)
    wind_score * 0.15 +             # é£åŠ› 15% (é™ä½)
    pressure_score * 0.15 +         # æ°”å‹ 15% â­ æ–°å¢
    humidity_score * 0.10 +         # æ¹¿åº¦ 10% â­ æ–°å¢
    seasonal_score * 0.05 +         # å­£èŠ‚ 5% â­ æ–°å¢
    lunar_score * 0.05              # æœˆç›¸ 5% â­ æ–°å¢
)
```

### 3.3 æ–°å¢æƒé‡å› å­è¯¦è§£

#### 3.3.1 æ°”å‹æƒé‡ï¼ˆ15%ï¼‰

**ç§‘å­¦ä¾æ®**ï¼š
- æ°”å‹å˜åŒ–ç›´æ¥å½±å“é±¼ç±»çš„é±¼é³”å‹åŠ›
- ä¸‹é™æ°”å‹é¢„ç¤ºå¤©æ°”ç³»ç»Ÿå˜åŒ–ï¼Œåˆºæ¿€é±¼ç±»è¿›é£Ÿ
- é’“é±¼ç ”ç©¶è¯å®æ°”å‹æ˜¯å½±å“é±¼ç±»æ´»åŠ¨çš„å…³é”®å› å­

**æœ€ä½³èŒƒå›´**ï¼š1005-1029 hPaï¼ˆæµ·å¹³é¢æ°”å‹ï¼‰

#### 3.3.2 æ¹¿åº¦æƒé‡ï¼ˆ10%ï¼‰

**ç§‘å­¦ä¾æ®**ï¼š
- æ¹¿åº¦æ˜¯æ°”å‹ç³»ç»Ÿå˜åŒ–çš„é—´æ¥æŒ‡æ ‡
- é«˜æ¹¿åº¦é€šå¸¸ä¼´éšä½æ°”å‹ç³»ç»Ÿ
- å½±å“ä½“æ„Ÿæ¸©åº¦å’Œé±¼ç±»èˆ’é€‚åº¦

#### 3.3.3 å­£èŠ‚æ€§æƒé‡ï¼ˆ5%ï¼‰

**ç§‘å­¦ä¾æ®**ï¼š
- åŸºäºé±¼ç±»ç”Ÿç‰©å­¦è§„å¾‹å’Œæ´»åŠ¨æ¨¡å¼
- æ˜¥å­£ï¼šç¹æ®–æœŸï¼Œæ´»è·ƒåº¦é«˜
- å¤å­£ï¼šé¿å¼€é«˜æ¸©ï¼Œæ—©æ™šæœ€ä½³
- ç§‹å­£ï¼šè§…é£ŸæœŸï¼Œå…¨å¤©è¾ƒå¥½
- å†¬å­£ï¼šä»£è°¢ç¼“æ…¢ï¼Œä¸­åˆç›¸å¯¹è¾ƒå¥½

#### 3.3.4 æœˆç›¸æƒé‡ï¼ˆ5%ï¼‰

**ç§‘å­¦ä¾æ®**ï¼š
- æœˆçƒå¼•åŠ›å½±å“æ½®æ±å’Œé±¼ç±»æ´»åŠ¨
- åŸºäºä¼ ç»Ÿé’“é±¼ç»éªŒå’Œå¤©æ–‡è§‚å¯Ÿ
- æ»¡æœˆæœŸé—´é±¼ç±»å¤œé—´æ´»åŠ¨å¢åŠ 

### 3.4 è¶‹åŠ¿åˆ†æå¢å¼º

#### 3.4.1 æ°”å‹è¶‹åŠ¿åˆ†æ

**ä¸‹é™æ°”å‹å¥–åŠ±æœºåˆ¶**ï¼š
- å¿«é€Ÿä¸‹é™ï¼ˆ<-2 hPa/6hï¼‰ï¼š+15åˆ†å¥–åŠ±
- ç¼“æ…¢ä¸‹é™ï¼ˆ-2~-0.5 hPa/6hï¼‰ï¼š+5åˆ†å¥–åŠ±
- ç¨³å®šï¼ˆÂ±0.5 hPa/6hï¼‰ï¼šæ­£å¸¸è¯„åˆ†
- ä¸Šå‡æ°”å‹ï¼šè¯„åˆ†é™ä½

**é’“é±¼é»„é‡‘æœŸè¯†åˆ«**ï¼š
- å¿«é€Ÿä¸‹é™æ°”å‹é€šå¸¸é¢„ç¤ºæš´é£é›¨å‰çš„æ´»è·ƒæœŸ
- è¿™æ˜¯ä¼ ç»Ÿä¸Šæœ€ç†æƒ³çš„é’“é±¼æ—¶æœº

#### 3.4.2 æ¸©åº¦å˜åŒ–è¶‹åŠ¿

**å‡æ¸©å¥–åŠ±æœºåˆ¶**ï¼š
- å¿«é€Ÿå‡æ¸©ï¼ˆ>3Â°C/6hï¼‰ï¼š+10åˆ†å¥–åŠ±
- ç¼“æ…¢å‡æ¸©ï¼ˆ1-3Â°C/6hï¼‰ï¼š+5åˆ†å¥–åŠ±
- ç¨³å®šæ¸©åº¦ï¼šæ­£å¸¸è¯„åˆ†
- å¿«é€Ÿé™æ¸©ï¼šè¯„åˆ†é™ä½

#### 3.4.3 é£é€Ÿç¨³å®šæ€§åˆ†æ

**ç¨³å®šæ€§è¯„åˆ†**ï¼š
- æ ‡å‡†å·® < 1 km/hï¼š+5åˆ†å¥–åŠ±
- æ ‡å‡†å·® < 2 km/hï¼šæ­£å¸¸è¯„åˆ†
- æ ‡å‡†å·® < 4 km/hï¼š-10åˆ†æƒ©ç½š
- æ ‡å‡†å·® > 4 km/hï¼š-20åˆ†æƒ©ç½š

### 3.5 ç®—æ³•æ¶æ„

```python
class EnhancedFishingScorer:
    """å¢å¼ºé’“é±¼è¯„åˆ†å™¨"""

    def __init__(self):
        self.weather_analyzer = WeatherTrendAnalyzer()
        self.astronomical_calculator = AstronomicalCalculator()
        self.seasonal_analyzer = SeasonalAnalyzer()
        self.pressure_analyzer = PressureTrendAnalyzer()

    def calculate_comprehensive_score(
        self,
        hourly_data: Dict[str, Any],
        historical_data: List[Dict[str, Any]],
        date: datetime
    ) -> FishingScore:
        """
        è®¡ç®—ç»¼åˆé’“é±¼è¯„åˆ†
        """
        # 1. åŸºç¡€è¯„åˆ†è®¡ç®—
        base_scores = self._calculate_base_scores(hourly_data)

        # 2. è¶‹åŠ¿åˆ†æ
        trend_analysis = self._analyze_trends(historical_data)

        # 3. æ–°æƒé‡å› å­è®¡ç®—
        pressure_score = self.pressure_analyzer.calculate_comprehensive_score(
            hourly_data['pressure'],
            trend_analysis['pressure_series']
        )

        humidity_score = self._calculate_humidity_score(hourly_data['humidity'])

        seasonal_score = self.seasonal_analyzer.calculate_seasonal_score(
            date,
            self._get_time_of_day(hourly_data['datetime'])
        )

        lunar_score = self.astronomical_calculator.calculate_lunar_score(
            date,
            self._get_time_of_day(hourly_data['datetime'])
        )

        # 4. ç»¼åˆæƒé‡è®¡ç®—
        weights = {
            'temperature': 0.25,
            'weather': 0.20,
            'wind': 0.15,
            'pressure': 0.15,
            'humidity': 0.10,
            'seasonal': 0.05,
            'lunar': 0.05
        }

        overall_score = (
            base_scores['temperature'] * weights['temperature'] +
            base_scores['weather'] * weights['weather'] +
            base_scores['wind'] * weights['wind'] +
            pressure_score * weights['pressure'] +
            humidity_score * weights['humidity'] +
            seasonal_score * weights['seasonal'] +
            lunar_score * weights['lunar']
        )

        # 5. è¶‹åŠ¿è°ƒæ•´
        overall_score *= trend_analysis['temperature']['multiplier']
        overall_score *= trend_analysis['wind']['multiplier']

        return FishingScore(
            overall=min(100, max(0, overall_score)),
            temperature=base_scores['temperature'],
            weather=base_scores['weather'],
            wind=base_scores['wind'],
            pressure=pressure_score,
            humidity=humidity_score,
            seasonal=seasonal_score,
            lunar=lunar_score,
            breakdown=weights,
            analysis_details=trend_analysis
        )
```

---

## 4. æ•°å­¦å…¬å¼è¯¦è§£

### 4.1 æ°”å‹è¯„åˆ†æ•°å­¦æ¨¡å‹

#### 4.1.1 åŸºç¡€æ°”å‹è¯„åˆ†å‡½æ•°

```math
P_{base}(p) =
\begin{cases}
100, & 1005 \leq p \leq 1029 \\
85, & p < 1005 \\
75, & 1029 < p \leq 1035 \\
65, & p > 1035
\end{cases}
```

å…¶ä¸­ï¼š
- $p$ï¼šå½“å‰æ°”å‹å€¼ï¼ˆhPaï¼‰
- $P_{base}$ï¼šåŸºç¡€æ°”å‹è¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰

#### 4.1.2 æ°”å‹è¶‹åŠ¿è¯„åˆ†å‡½æ•°

```math
T_{pressure}(\Delta p) =
\begin{cases}
115, & \Delta p < -2 \\
105, & -2 \leq \Delta p < -0.5 \\
100, & -0.5 \leq \Delta p \leq 0.5 \\
85, & 0.5 < \Delta p \leq 2 \\
70, & \Delta p > 2
\end{cases}
```

å…¶ä¸­ï¼š
- $\Delta p$ï¼š6å°æ—¶æ°”å‹å˜åŒ–é‡ï¼ˆhPaï¼‰
- $T_{pressure}$ï¼šè¶‹åŠ¿è°ƒæ•´ç³»æ•°ï¼ˆ0.70-1.15ï¼‰

#### 4.1.3 ç»¼åˆæ°”å‹è¯„åˆ†

```math
P_{comprehensive} = P_{base}(p) \times 0.7 + T_{pressure}(\Delta p) \times 0.3
```

### 4.2 æ¹¿åº¦è¯„åˆ†æ•°å­¦æ¨¡å‹

```math
H(h) =
\begin{cases}
100, & 60 \leq h \leq 80 \\
95, & 80 < h \leq 90 \\
90, & 90 < h \leq 95 \\
80, & 40 \leq h < 60 \\
65, & \text{å…¶ä»–}
\end{cases}
```

å…¶ä¸­ï¼š
- $h$ï¼šç›¸å¯¹æ¹¿åº¦ï¼ˆ%ï¼‰
- $H(h)$ï¼šæ¹¿åº¦è¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰

### 4.3 å­£èŠ‚æ€§è¯„åˆ†æ•°å­¦æ¨¡å‹

#### 4.3.1 æ˜¥å­£è¯„åˆ†å‡½æ•°

```math
S_{spring}(h) =
\begin{cases}
100, & 6 \leq h \leq 9 \text{ æˆ– } 17 \leq h \leq 19 \\
85, & 10 \leq h \leq 16 \\
70, & \text{å…¶ä»–}
\end{cases}
```

#### 4.3.2 å¤å­£è¯„åˆ†å‡½æ•°

```math
S_{summer}(h) =
\begin{cases}
100, & 5 \leq h \leq 8 \text{ æˆ– } 18 \leq h \leq 20 \\
60, & 11 \leq h \leq 15 \\
80, & \text{å…¶ä»–}
\end{cases}
```

#### 4.3.3 ç§‹å­£è¯„åˆ†å‡½æ•°

```math
S_{autumn}(h) =
\begin{cases}
100, & 7 \leq h \leq 10 \text{ æˆ– } 16 \leq h \leq 19 \\
85, & \text{å…¶ä»–}
\end{cases}
```

#### 4.3.4 å†¬å­£è¯„åˆ†å‡½æ•°

```math
S_{winter}(h) =
\begin{cases}
90, & 11 \leq h \leq 14 \\
75, & 9 \leq h \leq 16 \\
50, & \text{å…¶ä»–}
\end{cases}
```

### 4.4 æœˆç›¸è¯„åˆ†æ•°å­¦æ¨¡å‹

#### 4.4.1 æœˆç›¸è®¡ç®—ç®—æ³•

```math
JD = C + E + D - 694039.09
```

```math
\phi = \frac{JD + 4.867}{29.53059} \mod 1
```

```math
P = \lfloor \phi \times 8 \rfloor
```

å…¶ä¸­ï¼š
- $JD$ï¼šç®€åŒ–çš„å„’ç•¥æ—¥
- $C$ï¼šå¹´ä»½å› å­ï¼ˆ365.25 Ã— å¹´ï¼‰
- $E$ï¼šæœˆä»½å› å­ï¼ˆ30.6 Ã— æœˆï¼‰
- $D$ï¼šæ—¥æœŸ
- $\phi$ï¼šæœˆç›¸å°æ•°éƒ¨åˆ†
- $P$ï¼šæœˆç›¸ç´¢å¼•ï¼ˆ0-7ï¼‰

#### 4.4.2 æœˆç›¸è¯„åˆ†å‡½æ•°

```math
L(P, n) =
\begin{cases}
85, & P = 0 \text{ (æ–°æœˆ)} \\
80, & P = 1 \text{ æˆ– } 7 \text{ (å¨¥çœ‰æœˆ)} \\
75, & P = 2 \text{ æˆ– } 6 \text{ (ä¸Šä¸‹å¼¦)} \\
82, & P = 3 \text{ æˆ– } 5 \text{ (å‡¸æœˆ)} \\
90, & P = 4 \text{ (æ»¡æœˆ) ä¸” } n = \text{å¤œé—´} \\
65, & P = 4 \text{ (æ»¡æœˆ) ä¸” } n = \text{ç™½å¤©} \\
75, & \text{å…¶ä»–}
\end{cases}
```

### 4.5 ç»¼åˆè¯„åˆ†æ•°å­¦æ¨¡å‹

```math
S_{overall} = \sum_{i=1}^{7} w_i \times S_i
```

å…¶ä¸­ï¼š
- $S_{overall}$ï¼šç»¼åˆè¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰
- $w_i$ï¼šç¬¬iä¸ªæƒé‡å› å­çš„æƒé‡ç³»æ•°
- $S_i$ï¼šç¬¬iä¸ªæƒé‡å› å­çš„è¯„åˆ†

æƒé‡ç³»æ•°å‘é‡ï¼š
```math
\mathbf{w} = [0.25, 0.20, 0.15, 0.15, 0.10, 0.05, 0.05]
```

### 4.6 è¶‹åŠ¿è°ƒæ•´æ•°å­¦æ¨¡å‹

#### 4.6.1 æ¸©åº¦è¶‹åŠ¿è°ƒæ•´

```math
M_{temp}(\Delta T) =
\begin{cases}
1.10, & \Delta T > 3 \\
1.05, & 1 < \Delta T \leq 3 \\
1.00, & -1 \leq \Delta T \leq 1 \\
0.90, & \Delta T < -3 \\
0.80, & \text{å…¶ä»–}
\end{cases}
```

#### 4.6.2 é£é€Ÿç¨³å®šæ€§è°ƒæ•´

```math
M_{wind}(\sigma_w) =
\begin{cases}
1.05, & \sigma_w < 1 \\
1.00, & 1 \leq \sigma_w < 2 \\
0.90, & 2 \leq \sigma_w < 4 \\
0.80, & \sigma_w \geq 4
\end{cases}
```

#### 4.6.3 æœ€ç»ˆè°ƒæ•´è¯„åˆ†

```math
S_{final} = S_{overall} \times M_{temp} \times M_{wind}
```

---

## 5. å®ç°æŒ‡å—

### 5.1 ç³»ç»Ÿæ¶æ„è®¾è®¡

#### 5.1.1 æ¨¡å—ç»“æ„

```
fishing_score_system/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ enhanced_fishing_scorer.py    # ä¸»è¯„åˆ†å™¨
â”‚   â”œâ”€â”€ weather_trend_analyzer.py    # è¶‹åŠ¿åˆ†æå™¨
â”‚   â”œâ”€â”€ pressure_analyzer.py         # æ°”å‹åˆ†æå™¨
â”‚   â”œâ”€â”€ seasonal_analyzer.py         # å­£èŠ‚åˆ†æå™¨
â”‚   â””â”€â”€ astronomical_calculator.py    # å¤©æ–‡è®¡ç®—å™¨
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ math_utils.py               # æ•°å­¦å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ config.py                   # é…ç½®ç®¡ç†
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_algorithms.py          # ç®—æ³•æµ‹è¯•
â”‚   â”œâ”€â”€ test_integration.py         # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_performance.py         # æ€§èƒ½æµ‹è¯•
â””â”€â”€ examples/
    â”œâ”€â”€ current_system_demo.py       # å½“å‰ç³»ç»Ÿæ¼”ç¤º
    â”œâ”€â”€ enhanced_system_demo.py      # å¢å¼ºç³»ç»Ÿæ¼”ç¤º
    â””â”€â”€ comparison_analysis.py       # å¯¹æ¯”åˆ†æ
```

### 5.2 æ ¸å¿ƒç±»è®¾è®¡

#### 5.2.1 EnhancedFishingScorer ä¸»ç±»

```python
class EnhancedFishingScorer:
    """å¢å¼ºé’“é±¼è¯„åˆ†å™¨"""

    def __init__(self):
        """åˆå§‹åŒ–å¢å¼ºè¯„åˆ†å™¨"""
        self.weather_analyzer = WeatherTrendAnalyzer(window_size=6)
        self.astronomical_calculator = AstronomicalCalculator()
        self.seasonal_analyzer = SeasonalAnalyzer()
        self.pressure_analyzer = PressureTrendAnalyzer()

        # è¯„åˆ†æƒé‡é…ç½®
        self.weights = {
            'temperature': 0.25,
            'weather': 0.20,
            'wind': 0.15,
            'pressure': 0.15,
            'humidity': 0.10,
            'seasonal': 0.05,
            'lunar': 0.05
        }

    def calculate_comprehensive_score(
        self,
        hourly_data: Dict[str, Any],
        historical_data: List[Dict[str, Any]],
        date: datetime
    ) -> FishingScore:
        """
        è®¡ç®—ç»¼åˆé’“é±¼è¯„åˆ†

        Args:
            hourly_data: å½“å‰å°æ—¶æ•°æ®
            historical_data: å†å²æ•°æ®åºåˆ—ï¼ˆç”¨äºè¶‹åŠ¿åˆ†æï¼‰
            date: ç›®æ ‡æ—¥æœŸ

        Returns:
            FishingScore: è¯¦ç»†çš„è¯„åˆ†ç»“æœ
        """
        try:
            # 1. åŸºç¡€è¯„åˆ†è®¡ç®—
            base_scores = self._calculate_base_scores(hourly_data)

            # 2. è¶‹åŠ¿åˆ†æ
            trend_analysis = self._analyze_trends(historical_data)

            # 3. æ–°æƒé‡å› å­è®¡ç®—
            enhanced_scores = self._calculate_enhanced_scores(
                hourly_data, trend_analysis, date
            )

            # 4. ç»¼åˆæƒé‡è®¡ç®—
            overall_score = self._calculate_weighted_score(
                base_scores, enhanced_scores
            )

            # 5. è¶‹åŠ¿è°ƒæ•´
            adjusted_score = self._apply_trend_adjustments(
                overall_score, trend_analysis
            )

            # 6. åˆ›å»ºè¯„åˆ†ç»“æœ
            return FishingScore(
                overall=min(100, max(0, adjusted_score)),
                temperature=base_scores['temperature'],
                weather=base_scores['weather'],
                wind=base_scores['wind'],
                pressure=enhanced_scores['pressure'],
                humidity=enhanced_scores['humidity'],
                seasonal=enhanced_scores['seasonal'],
                lunar=enhanced_scores['lunar'],
                breakdown=self.weights,
                analysis_details=trend_analysis,
                timestamp=datetime.now()
            )

        except Exception as e:
            self.logger.error(f"ç»¼åˆè¯„åˆ†è®¡ç®—å¤±è´¥: {e}")
            return self._create_error_score(str(e))
```

### 5.3 é…ç½®ç®¡ç†

#### 5.3.1 è¯„åˆ†æƒé‡é…ç½®

```python
# config.py
class ScoringConfig:
    """è¯„åˆ†ç³»ç»Ÿé…ç½®ç±»"""

    # æƒé‡é…ç½®
    WEIGHTS = {
        'temperature': 0.25,
        'weather': 0.20,
        'wind': 0.15,
        'pressure': 0.15,
        'humidity': 0.10,
        'seasonal': 0.05,
        'lunar': 0.05
    }

    # æ°”å‹é…ç½®
    PRESSURE_CONFIG = {
        'optimal_range': (1005, 1029),  # hPa
        'trend_window_hours': 6,
        'bonus_threshold': 2.0
    }

    # å­£èŠ‚é…ç½®
    SEASONAL_CONFIG = {
        'spring_months': [3, 4, 5],
        'summer_months': [6, 7, 8],
        'autumn_months': [9, 10, 11],
        'winter_months': [12, 1, 2]
    }

    # åŠŸèƒ½å¼€å…³
    FEATURES = {
        'enable_trend_analysis': True,
        'enable_lunar_phases': True,
        'enable_seasonal_adjustments': True,
        'debug_mode': False
    }

# ç¯å¢ƒå˜é‡æ”¯æŒ
def load_config():
    """åŠ è½½é…ç½®ï¼Œæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–"""
    config = ScoringConfig()

    # ä»ç¯å¢ƒå˜é‡åŠ è½½æƒé‡
    for factor in config.WEIGHTS:
        env_var = f"FISHING_WEIGHT_{factor.upper()}"
        if os.getenv(env_var):
            try:
                config.WEIGHTS[factor] = float(os.getenv(env_var))
            except ValueError:
                logger.warning(f"æ— æ•ˆçš„æƒé‡é…ç½®: {env_var}")

    return config
```

### 5.4 æ•°æ®é¢„å¤„ç†

#### 5.4.1 æ•°æ®éªŒè¯

```python
class DataValidator:
    """æ•°æ®éªŒè¯å™¨"""

    @staticmethod
    def validate_hourly_data(data: Dict[str, Any]) -> bool:
        """éªŒè¯å°æ—¶æ•°æ®æ ¼å¼å’Œå®Œæ•´æ€§"""
        required_fields = [
            'temperature', 'condition', 'wind_speed',
            'humidity', 'pressure', 'datetime'
        ]

        for field in required_fields:
            if field not in data:
                logger.error(f"ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")
                return False

            # æ•°å€¼ç±»å‹æ£€æŸ¥
            if field in ['temperature', 'wind_speed', 'humidity', 'pressure']:
                try:
                    float(data[field])
                except (ValueError, TypeError):
                    logger.error(f"å­—æ®µ{field}ç±»å‹é”™è¯¯: {data[field]}")
                    return False

        return True

    @staticmethod
    def validate_historical_data(data: List[Dict[str, Any]]) -> bool:
        """éªŒè¯å†å²æ•°æ®åºåˆ—"""
        if not data or len(data) < 3:
            logger.warning("å†å²æ•°æ®ä¸è¶³ï¼Œæ— æ³•è¿›è¡Œè¶‹åŠ¿åˆ†æ")
            return False

        # æ£€æŸ¥æ•°æ®è¿ç»­æ€§
        timestamps = [item.get('timestamp') for item in data]
        if not all(timestamps):
            logger.warning("å†å²æ•°æ®ç¼ºå°‘æ—¶é—´æˆ³")
            return False

        # æ£€æŸ¥æ—¶é—´åºåˆ—é•¿åº¦
        time_span = max(timestamps) - min(timestamps)
        if time_span > 48 * 3600:  # 48å°æ—¶
            logger.warning(f"å†å²æ•°æ®æ—¶é—´è·¨åº¦è¿‡å¤§: {time_span/3600}å°æ—¶")

        return True
```

### 5.5 ç¼“å­˜ç­–ç•¥

#### 5.5.1 å¤šå±‚ç¼“å­˜æ¶æ„

```python
class ScoringCacheManager:
    """è¯„åˆ†ç¼“å­˜ç®¡ç†å™¨"""

    def __init__(self):
        # L1: å†…å­˜ç¼“å­˜
        self.memory_cache = TTLCache(maxsize=1000, ttl=3600)  # 1å°æ—¶

        # L2: æ–‡ä»¶ç¼“å­˜
        self.file_cache = FileCache('scoring_cache.json')

        # L3: è¶‹åŠ¿ç¼“å­˜
        self.trend_cache = TTLCache(maxsize=100, ttl=7200)  # 2å°æ—¶

    def get_cached_score(self, cache_key: str):
        """è·å–ç¼“å­˜çš„è¯„åˆ†ç»“æœ"""
        # L1ç¼“å­˜æŸ¥æ‰¾
        if cache_key in self.memory_cache:
            return self.memory_cache[cache_key]

        # L2ç¼“å­˜æŸ¥æ‰¾
        cached_result = self.file_cache.get(cache_key)
        if cached_result:
            # æå‡åˆ°L1ç¼“å­˜
            self.memory_cache[cache_key] = cached_result
            return cached_result

        return None

    def cache_score(self, cache_key: str, score: FishingScore, ttl: int = 3600):
        """ç¼“å­˜è¯„åˆ†ç»“æœ"""
        # å­˜å‚¨åˆ°æ‰€æœ‰å±‚çº§
        self.memory_cache[cache_key] = score
        self.file_cache.set(cache_key, score, ttl)

        # ç¼“å­˜è¶‹åŠ¿æ•°æ®
        if hasattr(score, 'analysis_details'):
            trend_key = f"{cache_key}_trend"
            self.trend_cache[trend_key] = score.analysis_details
```

### 5.6 æ€§èƒ½ä¼˜åŒ–

#### 5.6.1 è®¡ç®—ä¼˜åŒ–

```python
class PerformanceOptimizer:
    """æ€§èƒ½ä¼˜åŒ–å™¨"""

    def __init__(self):
        # é¢„è®¡ç®—å¸¸ç”¨å€¼
        self.seasonal_cache = {}
        self.lunar_cache = {}

        # æ•°å€¼è®¡ç®—ä¼˜åŒ–
        self.math_cache = {}

    @lru_cache(maxsize=100)
    def get_seasonal_score(self, month: int, hour: int) -> float:
        """è·å–å­£èŠ‚æ€§è¯„åˆ†ï¼ˆç¼“å­˜ä¼˜åŒ–ï¼‰"""
        cache_key = f"{month}_{hour}"
        if cache_key in self.seasonal_cache:
            return self.seasonal_cache[cache_key]

        score = self._calculate_seasonal_score_internal(month, hour)
        self.seasonal_cache[cache_key] = score
        return score

    @lru_cache(maxsize=365)
    def get_lunar_phase(self, date: datetime) -> str:
        """è·å–æœˆç›¸ï¼ˆç¼“å­˜ä¼˜åŒ–ï¼‰"""
        cache_key = date.strftime('%Y-%m-%d')
        if cache_key in self.lunar_cache:
            return self.lunar_cache[cache_key]

        phase = self._calculate_lunar_phase_internal(date)
        self.lunar_cache[cache_key] = phase
        return phase
```

---

## 6. ä»£ç ç¤ºä¾‹

### 6.1 å½“å‰ç³»ç»Ÿæ¼”ç¤º

#### 6.1.1 åŸºç¡€è¯„åˆ†è®¡ç®—

```python
#!/usr/bin/env python3
"""
å½“å‰é’“é±¼è¯„åˆ†ç³»ç»Ÿæ¼”ç¤º
æ¼”ç¤º3å› å­ï¼ˆæ¸©åº¦ã€å¤©æ°”ã€é£åŠ›ï¼‰è¯„åˆ†ç®—æ³•
"""

import sys
import os
from datetime import datetime, timedelta

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

class CurrentFishingScorer:
    """å½“å‰ç³»ç»Ÿè¯„åˆ†å™¨"""

    def __init__(self):
        self.optimal_temp_range = (15, 25)
        self.optimal_wind_speed = (0, 15)

    def calculate_temperature_score(self, temperature: float) -> float:
        """è®¡ç®—æ¸©åº¦è¯„åˆ†"""
        min_temp, max_temp = self.optimal_temp_range

        if min_temp <= temperature <= max_temp:
            return 100.0
        elif temperature < min_temp:
            if temperature < 0:
                return 0.0
            ratio = temperature / min_temp
            return max(0.0, ratio * 80)
        else:
            if temperature > 35:
                return 0.0
            excess = temperature - max_temp
            ratio = max(0, 1 - excess / 10)
            return ratio * 80

    def calculate_weather_score(self, condition: str) -> float:
        """è®¡ç®—å¤©æ°”è¯„åˆ†"""
        condition = condition.lower()

        best_weather = ["å¤šäº‘", "é˜´"]
        for weather in best_weather:
            if weather in condition:
                return 100.0

        good_weather = ["æ™´", "å°é›¨"]
        for weather in good_weather:
            if weather in condition:
                return 85.0

        fair_weather = ["ä¸­é›¨"]
        for weather in fair_weather:
            if weather in condition:
                return 50.0

        poor_weather = ["å¤§é›¨", "æš´é›¨", "é›·é˜µé›¨"]
        for weather in poor_weather:
            if weather in condition:
                return 20.0

        terrible_weather = ["é›ª", "å†°é›¹", "é›¾", "éœ¾"]
        for weather in terrible_weather:
            if weather in condition:
                return 10.0

        return 50.0

    def calculate_wind_score(self, wind_speed: float) -> float:
        """è®¡ç®—é£åŠ›è¯„åˆ†"""
        min_wind, max_wind = self.optimal_wind_speed

        if min_wind <= wind_speed <= max_wind:
            return 100.0
        elif wind_speed < min_wind:
            return 85.0
        else:
            if wind_speed > 30:
                return 10.0
            excess = wind_speed - max_wind
            ratio = max(0, 1 - excess / 15)
            return ratio * 80

    def calculate_overall_score(self, temperature: float, condition: str, wind_speed: float) -> float:
        """è®¡ç®—ç»¼åˆè¯„åˆ†"""
        temp_score = self.calculate_temperature_score(temperature)
        weather_score = self.calculate_weather_score(condition)
        wind_score = self.calculate_wind_score(wind_speed)

        # å½“å‰ç³»ç»Ÿæƒé‡
        overall_score = (
            temp_score * 0.4 +      # æ¸©åº¦æƒé‡ 40%
            weather_score * 0.35 +     # å¤©æ°”æƒé‡ 35%
            wind_score * 0.25          # é£åŠ›æƒé‡ 25%
        )

        return overall_score

def demonstrate_current_system():
    """æ¼”ç¤ºå½“å‰ç³»ç»Ÿ"""
    print("ğŸ£ å½“å‰é’“é±¼è¯„åˆ†ç³»ç»Ÿæ¼”ç¤º")
    print("=" * 50)
    print("3å› å­è¯„åˆ†ç³»ç»Ÿï¼šæ¸©åº¦(40%) + å¤©æ°”(35%) + é£åŠ›(25%)")
    print()

    scorer = CurrentFishingScorer()

    # æµ‹è¯•ç”¨ä¾‹ï¼šå½“å¤©é’“é±¼æ¡ä»¶
    test_cases = [
        {
            'time': 'æ—©ä¸Š 6:00',
            'temperature': 16.5,
            'condition': 'å¤šäº‘',
            'wind_speed': 3.2,
            'description': 'ç†æƒ³é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'ä¸­åˆ 12:00',
            'temperature': 23.7,
            'condition': 'é˜´å¤©',
            'wind_speed': 2.8,
            'description': 'è‰¯å¥½é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'ä¸‹åˆ 15:00',
            'temperature': 28.5,
            'condition': 'æ™´å¤©',
            'wind_speed': 8.5,
            'description': 'è¾ƒå·®é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'å‚æ™š 18:00',
            'temperature': 18.2,
            'condition': 'å°é›¨',
            'wind_speed': 12.3,
            'description': 'æŒ‘æˆ˜æ€§æ¡ä»¶'
        },
        {
            'time': 'å¤œé—´ 21:00',
            'temperature': 12.8,
            'condition': 'å¤§é£',
            'wind_speed': 25.6,
            'description': 'æ¶åŠ£é’“é±¼æ¡ä»¶'
        }
    ]

    results = []
    for i, case in enumerate(test_cases, 1):
        overall_score = scorer.calculate_overall_score(
            case['temperature'],
            case['condition'],
            case['wind_speed']
        )

        results.append({
            'case': i,
            'time': case['time'],
            'description': case['description'],
            'conditions': f"{case['temperature']:.1f}Â°C, {case['condition']}, {case['wind_speed']:.1f}km/h",
            'individual_scores': {
                'temperature': scorer.calculate_temperature_score(case['temperature']),
                'weather': scorer.calculate_weather_score(case['condition']),
                'wind': scorer.calculate_wind_score(case['wind_speed'])
            },
            'overall_score': overall_score,
            'rating': get_rating_emoji(overall_score)
        })

    # æ˜¾ç¤ºç»“æœ
    print("ğŸ“Š è¯„åˆ†ç»“æœè¯¦æƒ…:")
    print("-" * 80)
    for result in results:
        individual = result['individual_scores']
        print(f"{result['case']}. {result['time']} - {result['description']}")
        print(f"   æ¡ä»¶: {result['conditions']}")
        print(f"   è¯„åˆ†: æ¸©åº¦{individual['temperature']:.1f}åˆ† + å¤©æ°”{individual['weather']:.1f}åˆ† + é£åŠ›{individual['wind']:.1f}åˆ†")
        print(f"   æ€»åˆ†: {result['overall_score']:.1f}åˆ† {result['rating']}")
        print()

    # åˆ†æè¯„åˆ†åˆ†å¸ƒ
    scores = [result['overall_score'] for result in results]
    avg_score = sum(scores) / len(scores)
    best_score = max(scores)
    worst_score = min(scores)

    print("ğŸ“ˆ ç»Ÿè®¡åˆ†æ:")
    print(f"  å¹³å‡è¯„åˆ†: {avg_score:.1f}åˆ†")
    print(f"  æœ€ä½³è¯„åˆ†: {best_score:.1fåˆ†")
    print(f"  æœ€å·®è¯„åˆ†: {worst_score:.1f}åˆ†")
    print(f"  è¯„åˆ†èŒƒå›´: {worst_score:.1f} - {best_score:.1f}åˆ†")
    print(f"  è¯„åˆ†æ–¹å·®: {calculate_variance(scores):.1f}")

def get_rating_emoji(score: float) -> str:
    """è·å–è¯„åˆ†å¯¹åº”çš„è¡¨æƒ…ç¬¦å·"""
    if score >= 90:
        return "ğŸŒŸ ä¼˜ç§€"
    elif score >= 80:
        return "ğŸ‘ è‰¯å¥½"
    elif score >= 70:
        return "ğŸ‘Œ ä¸€èˆ¬"
    elif score >= 60:
        return "ğŸ˜ è¾ƒå·®"
    else:
        return "âŒ æå·®"

def calculate_variance(scores: list) -> float:
    """è®¡ç®—æ–¹å·®"""
    mean = sum(scores) / len(scores)
    variance = sum((x - mean) ** 2 for x in scores) / len(scores)
    return variance

if __name__ == "__main__":
    demonstrate_current_system()
```

### 6.2 å¢å¼ºç³»ç»Ÿæ¼”ç¤º

#### 6.2.1 7å› å­è¯„åˆ†ç³»ç»Ÿå®Œæ•´å®ç°

```python
#!/usr/bin/env python3
"""
å¢å¼ºé’“é±¼è¯„åˆ†ç³»ç»Ÿæ¼”ç¤º
7å› å­è¯„åˆ†ç³»ç»Ÿï¼šæ¸©åº¦ã€å¤©æ°”ã€é£åŠ›ã€æ°”å‹ã€æ¹¿åº¦ã€å­£èŠ‚æ€§ã€æœˆç›¸
"""

import sys
import os
import math
import calendar
from datetime import datetime, timedelta
from typing import Dict, Any, List

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

class EnhancedFishingScorer:
    """å¢å¼ºé’“é±¼è¯„åˆ†å™¨"""

    def __init__(self):
        # æƒé‡é…ç½®
        self.weights = {
            'temperature': 0.25,  # æ¸©åº¦ 25%
            'weather': 0.20,      # å¤©æ°” 20%
            'wind': 0.15,         # é£åŠ› 15%
            'pressure': 0.15,      # æ°”å‹ 15% (æ–°å¢)
            'humidity': 0.10,      # æ¹¿åº¦ 10% (æ–°å¢)
            'seasonal': 0.05,     # å­£èŠ‚ 5% (æ–°å¢)
            'lunar': 0.05          # æœˆç›¸ 5% (æ–°å¢)
        }

        # è¯„åˆ†é…ç½®
        self.pressure_optimal_range = (1005, 1029)  # hPa
        self.seasonal_config = {
            'spring': [3, 4, 5],
            'summer': [6, 7, 8],
            'autumn': [9, 10, 11],
            'winter': [12, 1, 2]
        }

    def calculate_pressure_score(self, pressure: float, pressure_trend: Dict[str, Any]) -> float:
        """è®¡ç®—æ°”å‹è¯„åˆ†"""
        # åŸºç¡€è¯„åˆ†
        if self.pressure_optimal_range[0] <= pressure <= self.pressure_optimal_range[1]:
            base_score = 100.0
        elif pressure < self.pressure_optimal_range[0]:
            base_score = 85.0  # ä½æ°”å‹ç³»ç»Ÿï¼ˆé±¼ç±»æ´»è·ƒï¼‰
        elif pressure > 1035:
            base_score = 65.0  # æé«˜æ°”å‹ï¼ˆé±¼ç±»ä¸æ´»è·ƒï¼‰
        else:
            base_score = 75.0  # é«˜æ°”å‹ï¼ˆä¸€èˆ¬ï¼‰

        # è¶‹åŠ¿è¯„åˆ†
        trend_multiplier = pressure_trend.get('multiplier', 1.0)

        return min(115, base_score * trend_multiplier)

    def calculate_humidity_score(self, humidity: float) -> float:
        """è®¡ç®—æ¹¿åº¦è¯„åˆ†"""
        if 60 <= humidity <= 80:
            return 100.0      # ç†æƒ³æ¹¿åº¦
        elif 80 < humidity <= 90:
            return 95.0       # é«˜æ¹¿åº¦ï¼ˆä½æ°”å‹ä¿¡å·ï¼‰
        elif 90 < humidity <= 95:
            return 90.0       # å¾ˆé«˜æ¹¿åº¦
        elif 40 <= humidity < 60:
            return 80.0       # ä¸­ç­‰æ¹¿åº¦
        else:
            return 65.0       # æç«¯æ¹¿åº¦

    def calculate_seasonal_score(self, date: datetime) -> float:
        """è®¡ç®—å­£èŠ‚æ€§è¯„åˆ†"""
        month = date.month
        hour = date.hour

        if month in self.seasonal_config['spring']:  # æ˜¥å­£
            if 6 <= hour <= 9 or 17 <= hour <= 19:
                return 100.0
            elif 10 <= hour <= 16:
                return 85.0
            else:
                return 70.0

        elif month in self.seasonal_config['summer']:  # å¤å­£
            if 5 <= hour <= 8 or 18 <= hour <= 20:
                return 100.0
            elif 11 <= hour <= 15:
                return 60.0  # ä¸­åˆæœ€å·®
            else:
                return 80.0

        elif month in self.seasonal_config['autumn']:  # ç§‹å­£
            if 7 <= hour <= 10 or 16 <= hour <= 19:
                return 100.0
            else:
                return 85.0

        else:  # å†¬å­£
            if 11 <= hour <= 14:
                return 90.0   # ä¸­åˆæœ€ä½³
            elif 9 <= hour <= 16:
                return 75.0   # ç™½å¤©å°šå¯
            else:
                return 50.0   # æ—©æ™šå¾ˆå·®

    def calculate_lunar_phase(self, date: datetime) -> str:
        """è®¡ç®—æœˆç›¸ï¼ˆç®€åŒ–ç®—æ³•ï¼‰"""
        # ç®€åŒ–çš„å„’ç•¥æ—¥è®¡ç®—
        year, month, day = date.year, date.month, date.day

        if month <= 2:
            year -= 1
            month += 12

        A = math.floor(year / 100)
        B = math.floor((year - A * 100) / 4)
        C = math.floor((year - A * 4 * 100 + B) / 4)
        E = math.floor((month + 1) * 30.6)

        # ç®€åŒ–çš„æœˆç›¸è®¡ç®—ï¼ˆå·²çŸ¥æ–°æœˆå‚è€ƒç‚¹ï¼‰
        jd = C + E + day - 694039.09
        lunar_cycle = 29.53059

        days_since_new = (jd + 4.867) % lunar_cycle
        phase_index = int((days_since_new / lunar_cycle) * 8)

        moon_phases = [
            'new_moon', 'waxing_crescent', 'first_quarter', 'waxing_gibbous',
            'full_moon', 'waning_gibbous', 'last_quarter', 'waning_crescent'
        ]

        return moon_phases[phase_index]

    def calculate_lunar_score(self, date: datetime, is_night: bool = False) -> float:
        """è®¡ç®—æœˆç›¸è¯„åˆ†"""
        moon_phase = self.calculate_lunar_phase(date)

        moon_scores = {
            'new_moon': 85,
            'waxing_crescent': 80,
            'first_quarter': 75,
            'waxing_gibbous': 82,
            'full_moon': 90 if is_night else 65,  # æ»¡æœˆå¤œé—´æä½³ï¼Œç™½å¤©ä¸€èˆ¬
            'waning_gibbous': 78,
            'last_quarter': 75,
            'waning_crescent': 80
        }

        return moon_scores.get(moon_phase, 75)

    def analyze_pressure_trend(self, pressure_series: List[float]) -> Dict[str, Any]:
        """åˆ†ææ°”å‹è¶‹åŠ¿"""
        if len(pressure_series) < 3:
            return {'multiplier': 1.0, 'trend': 'insufficient_data'}

        # è®¡ç®—6å°æ—¶å˜åŒ–è¶‹åŠ¿
        recent_avg = sum(pressure_series[-3:]) / 3
        earlier_avg = sum(pressure_series[-6:-3]) / 3 if len(pressure_series) >= 6 else recent_avg

        change = recent_avg - earlier_avg

        # ç¡®å®šè¶‹åŠ¿
        if change < -2:
            trend = 'falling_fast'
            multiplier = 1.20  # 20%å¥–åŠ±
        elif change < -0.5:
            trend = 'falling_slow'
            multiplier = 1.10  # 10%å¥–åŠ±
        elif -0.5 <= change <= 0.5:
            trend = 'stable'
            multiplier = 1.00
        elif change <= 2:
            trend = 'rising_slow'
            multiplier = 0.90  # -10%æƒ©ç½š
        else:
            trend = 'rising_fast'
            multiplier = 0.80  # -20%æƒ©ç½š

        return {
            'multiplier': multiplier,
            'trend': trend,
            'change_rate': change,
            'recent_avg': recent_avg,
            'earlier_avg': earlier_avg
        }

    def calculate_enhanced_overall_score(
        self,
        temperature: float,
        condition: str,
        wind_speed: float,
        pressure: float,
        humidity: float,
        date: datetime,
        historical_data: List[Dict[str, Any]] = None
    ) -> Dict[str, Any]:
        """è®¡ç®—å¢å¼ºç»¼åˆè¯„åˆ†"""
        # åŸºç¡€è¯„åˆ†ï¼ˆä½¿ç”¨ç°æœ‰ç®—æ³•ï¼‰
        base_scores = self._calculate_base_scores(temperature, condition, wind_speed)

        # è¶‹åŠ¿åˆ†æ
        pressure_series = [item.get('pressure', 1013) for item in historical_data[-6:]] if historical_data else [pressure] * 6
        trend_analysis = self.analyze_pressure_trend(pressure_series)

        # æ–°æƒé‡å› å­è®¡ç®—
        pressure_score = self.calculate_pressure_score(pressure, trend_analysis)
        humidity_score = self.calculate_humidity_score(humidity)
        seasonal_score = self.calculate_seasonal_score(date)
        lunar_score = self.calculate_lunar_score(date, self._is_night_time(date))

        # ç»¼åˆæƒé‡è®¡ç®—
        overall_score = (
            base_scores['temperature'] * self.weights['temperature'] +
            base_scores['weather'] * self.weights['weather'] +
            base_scores['wind'] * self.weights['wind'] +
            pressure_score * self.weights['pressure'] +
            humidity_score * self.weights['humidity'] +
            seasonal_score * self.weights['seasonal'] +
            lunar_score * self.weights['lunar']
        )

        # æœ€ç»ˆè¯„åˆ†é™åˆ¶åœ¨0-100èŒƒå›´å†…
        final_score = min(100, max(0, overall_score))

        return {
            'overall_score': final_score,
            'component_scores': {
                'temperature': base_scores['temperature'],
                'weather': base_scores['weather'],
                'wind': base_scores['wind'],
                'pressure': pressure_score,
                'humidity': humidity_score,
                'seasonal': seasonal_score,
                'lunar': lunar_score
            },
            'weights': self.weights,
            'analysis_details': {
                'pressure_trend': trend_analysis['trend'],
                'pressure_change': trend_analysis['change_rate'],
                'lunar_phase': self.calculate_lunar_phase(date),
                'season': self._get_season_name(date),
                'time_of_day': self._get_time_of_day(date)
            }
        }

    def _calculate_base_scores(self, temperature: float, condition: str, wind_speed: float) -> Dict[str, float]:
        """è®¡ç®—åŸºç¡€è¯„åˆ†ï¼ˆä¿æŒä¸ç°æœ‰ç³»ç»Ÿä¸€è‡´ï¼‰"""
        # è¿™é‡Œä½¿ç”¨ç®€åŒ–çš„è¯„åˆ†ç®—æ³•ï¼Œä¸ç°æœ‰ç³»ç»Ÿä¿æŒä¸€è‡´
        # å®é™…å®ç°ä¸­åº”è¯¥è°ƒç”¨ç°æœ‰çš„è¯„åˆ†æ–¹æ³•

        # æ¸©åº¦è¯„åˆ†
        optimal_temp_range = (15, 25)
        if optimal_temp_range[0] <= temperature <= optimal_temp_range[1]:
            temp_score = 100.0
        else:
            temp_score = 75.0  # ç®€åŒ–å¤„ç†

        # å¤©æ°”è¯„åˆ†
        condition = condition.lower()
        if 'å¤šäº‘' in condition or 'é˜´' in condition:
            weather_score = 100.0
        elif 'æ™´' in condition or 'å°é›¨' in condition:
            weather_score = 85.0
        else:
            weather_score = 60.0  # ç®€åŒ–å¤„ç†

        # é£åŠ›è¯„åˆ†
        optimal_wind_range = (0, 15)
        if optimal_wind_range[0] <= wind_speed <= optimal_wind_range[1]:
            wind_score = 100.0
        else:
            wind_score = 80.0  # ç®€åŒ–å¤„ç†

        return {
            'temperature': temp_score,
            'weather': weather_score,
            'wind': wind_score
        }

    def _is_night_time(self, date: datetime) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºå¤œé—´æ—¶é—´"""
        hour = date.hour
        return hour < 6 or hour > 18

    def _get_time_of_day(self, date: datetime) -> str:
        """è·å–æ—¶é—´æ®µæè¿°"""
        hour = date.hour
        if 5 <= hour <= 8:
            return 'early_morning'
        elif 9 <= hour <= 11:
            return 'morning'
        elif 12 <= hour <= 14:
            return 'noon'
        elif 15 <= hour <= 17:
            return 'afternoon'
        elif 18 <= hour <= 20:
            return 'evening'
        else:
            return 'night'

    def _get_season_name(self, date: datetime) -> str:
        """è·å–å­£èŠ‚åç§°"""
        month = date.month
        if month in self.seasonal_config['spring']:
            return 'spring'
        elif month in self.season_config['summer']:
            return 'summer'
        elif month in self.season_config['autumn']:
            return 'autumn'
        else:
            return 'winter'

def demonstrate_enhanced_system():
    """æ¼”ç¤ºå¢å¼ºç³»ç»Ÿ"""
    print("ğŸ¯ å¢å¼ºé’“é±¼è¯„åˆ†ç³»ç»Ÿæ¼”ç¤º")
    print("=" * 60)
    print("7å› å­è¯„åˆ†ç³»ç»Ÿï¼šæ¸©åº¦(25%) + å¤©æ°”(20%) + é£åŠ›(15%) + æ°”å‹(15%) + æ¹¿åº¦(10%) + å­£èŠ‚(5%) + æœˆç›¸(5%)")
    print()

    scorer = EnhancedFishingScorer()

    # æµ‹è¯•ç”¨ä¾‹ï¼šç›¸ä¼¼æ¡ä»¶ä¸‹çš„è¯„åˆ†å¯¹æ¯”
    test_date = datetime(2025, 11, 6, 14, 0)  # 2025å¹´11æœˆ6æ—¥ä¸‹åˆ2ç‚¹

    # æ„é€ å†å²æ•°æ®ç”¨äºè¶‹åŠ¿åˆ†æ
    historical_data = [
        {'timestamp': datetime(2025, 11, 6, 8, 0), 'pressure': 1015, 'temperature': 18.5},
        {'timestamp': datetime(2025, 11, 6, 9, 0), 'pressure': 1014, 'temperature': 19.2},
        {'timestamp': datetime(2025, 11, 6, 10, 0), 'pressure': 1013, 'temperature': 19.8},
        {'timestamp': datetime(2025, 11, 6, 11, 0), 'pressure': 1012, 'temperature': 20.5},
        {'timestamp': datetime(2025, 11, 6, 12, 0), 'pressure': 1011, 'temperature': 21.2},
        {'timestamp': datetime(2025, 11, 6, 13, 0), 'pressure': 1010, 'temperature': 21.8}
    ]

    # æµ‹è¯•ç”¨ä¾‹ï¼šå½“å¤©ä¸åŒæ—¶é—´æ®µçš„é’“é±¼æ¡ä»¶
    test_cases = [
        {
            'time': 'ä¸Šåˆ 6:00',
            'temperature': 18.1,
            'condition': 'å¤šäº‘',
            'wind_speed': 4.4,
            'pressure': 1013,
            'humidity': 65,
            'description': 'ç†æƒ³é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'ä¸­åˆ 12:00',
            'temperature': 23.7,
            'condition': 'é˜´å¤©',
            'wind_speed': 2.8,
            'pressure': 1011,
            'humidity': 68,
            'description': 'è‰¯å¥½é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'ä¸‹åˆ 15:00',
            'temperature': 23.1,
            'condition': 'é˜´å¤©',
            'wind_speed': 1.1,
            'pressure': 1009,
            'humidity': 70,
            'description': 'ä¼˜ç§€é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'å‚æ™š 18:00',
            'temperature': 19.5,
            'condition': 'æ™´é—´',
            'wind_speed': 6.2,
            'pressure': 1014,
            'humidity': 60,
            'description': 'è‰¯å¥½é’“é±¼æ¡ä»¶'
        },
        {
            'time': 'å¤œé—´ 21:00',
            'temperature': 12.8,
            'condition': 'é›¾å¤©',
            'wind_speed': 25.6,
            'pressure': 1000,
            'humidity': 85,
            'description': 'æ¶åŠ£é’“é±¼æ¡ä»¶'
        }
    ]

    print("ğŸ“Š å¢å¼ºè¯„åˆ†ç»“æœè¯¦æƒ…:")
    print("-" * 80)

    for result in test_cases:
        enhanced_result = scorer.calculate_enhanced_overall_score(
            result['temperature'],
            result['condition'],
            result['wind_speed'],
            result['pressure'],
            result['humidity'],
            test_date,
            historical_data
        )

        print(f"{result['time']} - {result['description']}")
        print(f"   åŸºç¡€æ¡ä»¶: {result['temperature']:.1f}Â°C, {result['condition']}, {result['wind_speed']:.1f}km/h")
        print(f"   å¢å¼ºæ¡ä»¶: æ°”å‹{result['pressure']}hPa, æ¹¿åº¦{result['humidity']}%")

        # æ˜¾ç¤ºå„å› å­è¯„åˆ†
        scores = enhanced_result['component_scores']
        print(f"   è¯„åˆ†è¯¦æƒ…:")
        print(f"     æ¸©åº¦: {scores['temperature']:.1f}åˆ† (æƒé‡25%)")
        print(f"     å¤©æ°”: {scores['weather']:.1f}åˆ† (æƒé‡20%)")
        print(f"     é£åŠ›: {scores['wind']:.1f}åˆ† (æƒé‡15%)")
        print(f"     æ°”å‹: {scores['pressure']:.1f}åˆ† (æƒé‡15%) â­")
        print(f"     æ¹¿åº¦: {scores['humidity']:.1f}åˆ† (æƒé‡10%) â­")
        print(f"     å­£èŠ‚: {scores['seasonal']:.1f}åˆ† (æƒé‡5%) â­")
        print(f"     æœˆç›¸: {scores['lunar']:.1f}åˆ† (æƒé‡5%) â­")

        # æ˜¾ç¤ºåˆ†æè¯¦æƒ…
        analysis = enhanced_result['analysis_details']
        print(f"   åˆ†æè¯¦æƒ…: {analysis['pressure_trend']}, æœˆç›¸{analysis['lunar_phase']}, {analysis['seasonal']}")

        print(f"   æ€»åˆ†: {enhanced_result['overall_score']:.1f}åˆ† {get_enhanced_rating_emoji(enhanced_result['overall_score'])}")
        print()

    # æ˜¾ç¤ºæƒé‡åˆ†å¸ƒ
    print("âš–ï¸ æƒé‡åˆ†å¸ƒ:")
    weights = scorer.weights
    for factor, weight in weights.items():
        marker = "â­" if factor in ['pressure', 'humidity', 'seasonal', 'lunar'] else "  "
        print(f"   {marker} {factor}: {weight*100:.0f}%")

    print()
    print("ğŸ“Š ç³»ç»Ÿå¯¹æ¯”:")
    print("å½“å‰ç³»ç»Ÿ: 3å› å­è¯„åˆ†ç³»ç»Ÿ")
    print("å¢å¼ºç³»ç»Ÿ: 7å› å­è¯„åˆ†ç³»ç»Ÿ (+4ä¸ªä¸“ä¸šå› å­)")
    print("é¢„æœŸæ•ˆæœ: æ˜¾è‘—æå‡è¯„åˆ†åŒºåˆ†åº¦å’Œå‡†ç¡®æ€§")

def get_enhanced_rating_emoji(score: float) -> str:
    """è·å–å¢å¼ºè¯„åˆ†å¯¹åº”çš„è¡¨æƒ…ç¬¦å·"""
    if score >= 95:
        return "ğŸ† å®Œç¾"
    elif score >= 90:
        return "ğŸŒŸ ä¼˜ç§€"
    elif score >= 80:
        return "ğŸ‘ è‰¯å¥½"
    elif score >= 70:
        return "ğŸ‘Œ ä¸€èˆ¬"
    elif score >= 60:
        return "ğŸ˜ è¾ƒå·®"
    else:
        return "âŒ æå·®"

if __name__main__":
    demonstrate_enhanced_system()
```

### 6.3 å¯¹æ¯”åˆ†ææ¼”ç¤º

#### 6.3.1 ç³»ç»Ÿå¯¹æ¯”åˆ†æ

```python
#!/usr/bin/env python3
"""
é’“é±¼è¯„åˆ†ç³»ç»Ÿå¯¹æ¯”åˆ†ææ¼”ç¤º
å¯¹æ¯”å½“å‰3å› å­ç³»ç»Ÿå’Œå¢å¼º7å› å­ç³»ç»Ÿçš„è¯„åˆ†å·®å¼‚
"""

import sys
import os
from datetime import datetime, timedelta

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from examples.current_system_demo import CurrentFishingScorer
from examples.enhanced_system_demo import EnhancedFishingScorer

def analyze_scoring_differences():
    """åˆ†æè¯„åˆ†å·®å¼‚"""
    print("ğŸ¯ é’“é±¼è¯„åˆ†ç³»ç»Ÿå¯¹æ¯”åˆ†æ")
    print("=" * 60)

    current_scorer = CurrentFishingScorer()
    enhanced_scorer = EnhancedFishingScorer()

    # æ¨¡æ‹ŸçœŸå®å¤©æ°”æ•°æ®åºåˆ—
    weather_sequence = [
        {
            'date': datetime(2025, 11, 6, 6, 0),   # æ—©ä¸Š6ç‚¹
            'temperature': 18.5,
            'condition': 'å¤šäº‘',
            'wind_speed': 4.4,
            'pressure': 1013,   # å¼€å§‹ä¸‹é™
            'humidity': 65,
            'historical_pressure': [1015, 1014, 1013, 1012, 1011, 1010]
        },
        {
            'date': datetime(2025, 11, 6, 12, 0),  # ä¸­åˆ12ç‚¹
            'temperature': 23.7,
            'condition': 'é˜´å¤©',
            'wind_speed': 2.8,
            'pressure': 1011,   # æŒç»­ä¸‹é™
            'humidity': 68,
            'historical_pressure': [1013, 1012, 1011, 1010, 1009, 1008]
        },
        {
            'date': datetime(2025, 11, 6, 18, 0),  # å‚æ™š18ç‚¹
            'temperature': 19.5,
            'condition': 'æ™´é—´å¤šäº‘',
            'wind_speed': 1.1,
            'pressure': 1009,   # ç»§ç»­ä¸‹é™
            'humidity': 70,
            'historical_pressure': [1011, 1010, 1009, 1008, 1007, 1006]
        }
    ]

    print("ğŸ“Š ç›¸åŒå¤©æ°”æ¡ä»¶ä¸‹çš„è¯„åˆ†å¯¹æ¯”:")
    print("-" * 80)

    results = []
    for i, data in enumerate(weather_sequence, 1):
        # å½“å‰ç³»ç»Ÿè¯„åˆ†
        current_score = current_scorer.calculate_overall_score(
            data['temperature'],
            data['condition'],
            data['wind_speed']
        )

        # å¢å¼ºç³»ç»Ÿè¯„åˆ†
        enhanced_result = enhanced_scorer.calculate_enhanced_overall_score(
            data['temperature'],
            data['condition'],
            data['wind_speed'],
            data['pressure'],
            data['humidity'],
            data['date'],
            data['historical_pressure']
        )

        # æ—¶é—´æè¿°
        time_desc = data['date'].strftime("%H:%M")

        results.append({
            'period': i,
            'time_desc': time_desc,
            'conditions': f"{data['temperature']:.1f}Â°C, {data['condition']}, {data['wind_speed']:.1f}km/h, {data['pressure']}hPa, {data['humidity']}%",
            'current_score': current_score,
            'enhanced_score': enhanced_result['overall_score'],
            'difference': enhanced_result['overall_score'] - current_score,
            'enhanced_details': enhanced_result['component_scores'],
            'analysis_details': enhanced_result['analysis_details']
        })

    # æ˜¾ç¤ºå¯¹æ¯”ç»“æœ
    print(f"{'æ—¶é—´æ®µ':<6} | 'æ—¶é—´':<8} | 'å½“å‰ç³»ç»Ÿ':<10} | 'å¢å¼ºç³»ç»Ÿ':<10} | 'å·®å¼‚':<8} | 'æƒé‡è°ƒæ•´'}")
    print("-" * 80)

    for result in results:
        enhanced_details = result['enhanced_details']
        analysis = result['analysis_details']

        # æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        print(f"{result['period']:<6} | {result['time_desc']:<8} | "
              f"{result['current_score']:<10.1f} | "
              f"{result['enhanced_score']:<10.1f} | "
              f"{result['difference']:<8.1f} |")

        # æ˜¾ç¤ºæ–°æƒé‡å› å­è´¡çŒ®
        new_factors = [
            ('æ°”å‹', enhanced_details['pressure']),
            ('æ¹¿åº¦', enhanced_details['humidity']),
            ('å­£èŠ‚', enhanced_details['seasonal']),
            ('æœˆç›¸', enhanced_details['lunar'])
        ]

        for factor, score in new_factors:
            contribution = score * 0.05 if factor in ['seasonal', 'lunar'] else score * (0.15 if factor == 'pressure' else 0.10)
            print(f"         {factor}:{contribution:>6.1f}åˆ†")

        print()

def analyze_differentiation_capability():
    """åˆ†æåŒºåˆ†èƒ½åŠ›"""
    print("ğŸ¯ åŒºåˆ†èƒ½åŠ›åˆ†æ")
    print("=" * 40)

    # æµ‹è¯•ç”¨ä¾‹ï¼šç›¸ä¼¼æ¡ä»¶
    similar_conditions = [
        {
            'scenario': 'ç›¸ä¼¼æ¡ä»¶1',
            'temp': 20.0,
            'condition': 'å¤šäº‘',
            'wind': 3.0,
            'pressure': 1012,
            'humidity': 65
        },
        {
            'scenario': 'ç›¸ä¼¼æ¡ä»¶2',
            'temp': 20.5,
            'condition': 'å¤šäº‘',
            'wind': 3.5,
            'pressure': 1011,
            'humidity': 68
        },
        {
            'scenario': 'ç›¸ä¼¼æ¡ä»¶3',
            'temp': 19.8,
            'condition': 'é˜´å¤©',
            'wind': 3.2,
            'pressure': 1010,
            'humidity': 67
        }
    ]

    current_scorer = CurrentFishingScorer()
    enhanced_scorer = EnhancedFishingScorer()

    test_date = datetime(2025, 11, 6, 14, 0)

    print("æµ‹è¯•åœºæ™¯: ç›¸ä¼¼æ¡ä»¶ä¸‹çš„è¯„åˆ†å·®å¼‚")
    print("-" * 60)

    current_scores = []
    enhanced_scores = []

    for scenario in similar_conditions:
        # å½“å‰ç³»ç»Ÿè¯„åˆ†
        current_score = current_scorer.calculate_overall_score(
            scenario['temp'],
            scenario['condition'],
            scenario['wind']
        )

        # å¢å¼ºç³»ç»Ÿè¯„åˆ†
        enhanced_result = enhanced_scorer.calculate_enhanced_overall_score(
            scenario['temp'],
            scenario['condition'],
            scenario['wind'],
            scenario['pressure'],
            scenario['humidity'],
            test_date
        )

        current_scores.append(current_score)
        enhanced_scores.append(enhanced_result['overall_score'])

        print(f"{scenario['scenario']:<12} | "
              f"æ¡ä»¶: {scenario['temp']:.1f}Â°C, {scenario['condition']}, {scenario['wind']:.1f}km/h")
        print(f"                     | "
              f"å½“å‰è¯„åˆ†: {current_score:.1f}åˆ†")
        print(f"                     | "
              f"å¢å¼ºè¯„åˆ†: {enhanced_result['overall_score']:.1f}åˆ†")
        print()

    # ç»Ÿè®¡åˆ†æ
    current_variance = calculate_variance(current_scores)
    enhanced_variance = calculate_variance(enhanced_scores)

    print("ğŸ“ˆ åŒºåˆ†èƒ½åŠ›ç»Ÿè®¡:")
    print("-" * 40)
    print(f"  å½“å‰ç³»ç»Ÿè¯„åˆ†æ–¹å·®: {current_variance:.2f}")
    print(f"  å¢å¼ºç³»ç»Ÿè¯„åˆ†æ–¹å·®: {enhanced_variance:.2f}")
    print(f"  æ–¹å·®æå‡: {(enhanced_variance - current_variance)/current_variance*100:.1f}%")
    print()

    # è¯„åˆ†å·®å¼‚åˆ†æ
    score_differences = []
    for i in range(len(similar_conditions)):
        diff = enhanced_scores[i] - current_scores[i]
        score_differences.append(abs(diff))
        print(f"  ç›¸ä¼¼æ¡ä»¶{i+1}: å·®å¼‚ {diff:.1f}åˆ†")

    max_diff = max(score_differences)
    avg_diff = sum(score_differences) / len(score_differences)

    print(f"  æœ€å¤§å·®å¼‚: {max_diff:.1f}åˆ†")
    print(f" å¹³å‡å·®å¼‚: {avg_diff:.1f}åˆ†")
    print(f" åŒºåˆ†æˆåŠŸ: {len([d for d in score_differences if d > 5])}/{len(score_differences)}")
    print()

    # æ”¹å–„å»ºè®®
    if max_diff > 5:
        print("âœ… æ˜¾è‘—æå‡: è§£å†³äº†è¯„åˆ†ç›¸åŒé—®é¢˜")
    else:
        print("âš ï¸ éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–: åŒºåˆ†åº¦ä»ç„¶æœ‰é™")

    if avg_diff > 2:
        print("âœ… æœ‰æ•ˆæ”¹è¿›: æä¾›äº†æ›´å¥½çš„åŒºåˆ†åº¦")
    else:
        print("âš ï¸ æ•ˆæœæœ‰é™: å»ºè®®å¢åŠ æ›´å¤šåŒºåˆ†å› å­")

def calculate_variance(scores: list) -> float:
    """è®¡ç®—æ–¹å·®"""
    mean = sum(scores) / len(scores)
    variance = sum((x - mean) ** 2 for x in scores) / len(scores)
    return variance

def provide_improvement_recommendations():
    """æä¾›æ”¹è¿›å»ºè®®"""
    print("ğŸ’¡ ç³»ç»Ÿæ”¹è¿›å»ºè®®")
    print("=" * 40)

    print("1. çŸ­æœŸæ”¹è¿›:")
    print("   - åŸºäºç”¨æˆ·åé¦ˆè°ƒä¼˜æƒé‡åˆ†é…")
    print("   - ä½¿ç”¨æœºå™¨å­¦ä¹ ä¼˜åŒ–æƒé‡å‚æ•°")
    print("   - è€ƒè™‘åœ°ç†ä½ç½®ç‰¹æ€§ï¼ˆæ·¡æ°´vsæµ·æ°´ï¼‰")
    print("   - æ·»åŠ é±¼ç±»ç‰©ç§ç‰¹å¼‚æ€§è°ƒæ•´")
    print()

    print("2. æ•°æ®è´¨é‡æå‡:")
    print("   - æé«˜å†å²æ•°æ®è´¨é‡")
    print("   - å¢åŠ æ•°æ®éªŒè¯æœºåˆ¶")
    print("   - å®ç°æ•°æ®æ¸…æ´—å’Œæ’å€¼ç®—æ³•")
    print("   - è€ƒè™‘ä½¿ç”¨æ›´å¤šæ°”è±¡æº")
    print()

    print("3. ç®—æ³•ä¼˜åŒ–:")
    print("   - å®ç°æ›´å¤æ‚çš„è¶‹åŠ¿åˆ†æç®—æ³•")
    print("   - è€ƒè™‘å¤šå› å­äº¤äº’å½±å“")
    print("   - æ·»åŠ åŠ¨æ€æƒé‡è°ƒæ•´æœºåˆ¶")
    print("   - ä¼˜åŒ–è®¡ç®—æ€§èƒ½å’Œç¼“å­˜ç­–ç•¥")
    print()

    print("4. åŠŸèƒ½æ‰©å±•:")
    print("   - æ·»åŠ é±¼ç±»è¡Œä¸ºé¢„æµ‹æ¨¡å‹")
    print("   - é›†æˆåœ°ç†ä½ç½®ç‰¹æ€§åˆ†æ")
    print("   - å¢åŠ å¤©æ°”é¢„è­¦å»ºè®®")
    print("   - å®ç°ä¸ªæ€§åŒ–æ¨èç®—æ³•")
    print()

if __name__main__":
    analyze_scoring_differences()
    analyze_differentiation_capability()
    provide_improvement_recommendations()
```

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1 çœŸå®åœºæ™¯æ¼”ç¤º

#### 7.1.1 å®Œæ•´é’“é±¼æ¨èç¤ºä¾‹

```python
#!/usr/bin/env python3
"""
å®Œæ•´é’“é±¼æ¨èç¤ºä¾‹
æ¼”ç¤ºå¦‚ä½•åœ¨å®é™…é’“é±¼åœºæ™¯ä¸­ä½¿ç”¨å¢å¼ºè¯„åˆ†ç³»ç»Ÿ
"""

import sys
import os
from datetime import datetime, timedelta

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))

from examples.enhanced_system_demo import EnhancedFishingScorer

def generate_fishing_recommendation(location: str, date: str):
    """ç”Ÿæˆé’“é±¼æ¨è"""
    print(f"ğŸ£ {location} {date} é’“é±¼æ—¶é—´æ¨èæŠ¥å‘Š")
    print("=" * 60)

    # æ¨¡æ‹Ÿè·å–å¤©æ°”æ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­ä»APIè·å–ï¼‰
    weather_data = get_real_weather_data(location, date)

    if not weather_data:
        print("âŒ æ— æ³•è·å–å¤©æ°”æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")
        return

    scorer = EnhancedFishingScorer()

    # è®¡ç®—å…¨å¤©è¯„åˆ†
    hourly_recommendations = []

    for hour in range(24):
        current_hour = date + timedelta(hours=hour)

        # æ„é€ å°æ—¶æ•°æ®
        hourly_data = extract_hourly_data(weather_data, current_hour)

        # è®¡ç®—è¯„åˆ†
        enhanced_result = scorer.calculate_enhanced_overall_score(
            hourly_data['temperature'],
            hourly_data['condition'],
            hourly_data['wind_speed'],
            hourly_data['pressure'],
            hourly_data['humidity'],
            current_hour,
            hourly_data.get('historical_data', [])
        )

        # æ„é€ æ¨èç»“æœ
        recommendation = {
            'hour': hour,
            'time_desc': format_time(hour),
            'score': enhanced_result['overall_score'],
            'rating': get_rating_emoji(enhanced_result['overall_score']),
            'conditions': {
                'temperature': hourly_data['temperature'],
                'condition': hourly_data['condition'],
                'wind_speed': hourly_data['wind_speed'],
                'pressure': hourly_data['pressure'],
                'humidity': hourly_data['humidity']
            },
            'enhanced_factors': {
                'pressure': enhanced_result['component_scores']['pressure'],
                'humidity': enhanced_result['component_scores']['humidity'],
                'seasonal': enhanced_result['component_scores']['seasonal'],
                'lunar': enhanced_result['component_scores']['lunar']
            }
        }

        hourly_recommendations.append(recommendation)

    # æ’åºå¹¶æ¨èæœ€ä½³æ—¶é—´æ®µ
    hourly_recommendations.sort(key=lambda x: x['score'], reverse=True)

    # æ˜¾ç¤ºæ¨èç»“æœ
    print("ğŸ† æœ€ä½³æ—¶é—´æ®µæ¨è:")
    print("-" * 40)

    for i, rec in enumerate(hourly_recommendations[:5], 1):  # æ˜¾ç¤ºå‰5ä¸ªæœ€ä½³æ—¶é—´æ®µ
        time_desc = rec['time_desc']
        score = rec['score']
        rating = rec['rating']
        conditions = rec['conditions']
        enhanced = rec['enhanced_factors']

        print(f"{i}. {time_desc} - {rating} {score:.1f}åˆ†")
        print(f"   å¤©æ°”: {conditions['condition']}, æ¸©åº¦: {conditions['temperature']:.1f}Â°C")
        print(f"   é£é€Ÿ: {conditions['wind_speed']:.1f}km/h, æ°”å‹: {conditions['pressure']}hPa")
        print(f"   æ¹¿åº¦: {conditions['humidity']}%")

        # æ˜¾ç¤ºå¢å¼ºå› å­è´¡çŒ®
        if enhanced['pressure'] > 80:
            print(f"   â­ æ°”å‹è¯„åˆ†{enhanced['pressure']:.1f}åˆ† - ä¸‹é™æ°”å‹è‰¯å¥½ä¿¡å·")
        if enhanced['humidity'] > 85:
            print(f"   ğŸ’§ æ¹¿åº¦è¯„åˆ†{enhanced['humidity']:.1f}åˆ† - é«˜æ¹¿åº¦æš—ç¤ºä½æ°”å‹")

        print()

    # æä¾›è¯¦ç»†åˆ†æ
    print("ğŸ“Š è¯¦ç»†åˆ†ææŠ¥å‘Š:")
    print("-" * 40)

    # ç»Ÿè®¡åˆ†æ
    scores = [rec['score'] for rec in hourly_recommendations]
    avg_score = sum(scores) / len(scores)
    best_score = max(scores)
    best_hours = [rec['hour'] for rec in hourly_recommendations if rec['score'] >= 80]

    print(f"  å¹³å‡è¯„åˆ†: {avg_score:.1f}åˆ†")
    print(f"  æœ€ä½³è¯„åˆ†: {best_score:.1f}åˆ†")
    print(f"  ä½³æ—¶æ®µæ•°é‡: {len(best_hours)}ä¸ª")
    print(f"  æ¨èæ—¶æ®µ: {', '.join([f'{h:02d}:00' for h in best_hours])}")
    print()

    # å¤©æ°”è¶‹åŠ¿åˆ†æ
    if 'pressure_trend' in hourly_recommendations[0]['enhanced_factors']:
        trend = hourly_recommendations[0]['enhanced_factors']['analysis_details']['pressure_trend']
        print(f"ğŸŒ¡ï¸ æ°”å‹è¶‹åŠ¿: {trend}")

        if trend == 'falling_fast':
            print("   âš¡ï¸ é¢„å‘Š: æ°”å‹å¿«é€Ÿä¸‹é™ - é±¼ç±»è¿›é£Ÿæ´»è·ƒæœŸï¼")
        elif trend == 'falling_slow':
            print("   âœ… æ³¨æ„: æ°”å‹ç¼“æ…¢ä¸‹é™ - é’“é±¼å¥½æ—¶æœº")
        elif trend == 'stable':
            print("   ğŸ’¡ï¸ æ°”å‹ç¨³å®š - æ­£å¸¸æƒ…å†µ")
        else:
            print("   âš ï¸ æ°”å‹ä¸Šå‡ - é’“é±¼æ´»è·ƒåº¦é™ä½")

    print()

    # ä¸“ä¸šå»ºè®®
    print("ğŸ’¡ ä¸“ä¸šé’“é±¼å»ºè®®:")
    suggestions = generate_fishing_suggestions(hourly_recommendations[:3])
    for i, suggestion in enumerate(suggestions, 1):
        print(f"{i}. {suggestion}")

    print()
    print("ğŸ¯ é¢„ç¥é’“é±¼æ„‰å¿«ï¼")

def get_real_weather_data(location: str, date: str) -> Dict[str, Any]:
    """
    æ¨¡æ‹Ÿè·å–çœŸå®å¤©æ°”æ•°æ®
    å®é™…åº”ç”¨ä¸­åº”è¯¥è°ƒç”¨å¤©æ°”API
    """
    # è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„å¤©æ°”API
    # ä¸ºäº†æ¼”ç¤ºï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®

    # æ ¹æ®åœ°ç‚¹æ¨¡æ‹Ÿä¸åŒçš„å¤©æ°”ç‰¹å¾
    if 'å»ºå¾·å¸‚' in location:
        return {
            'date': date,
            'location': location,
            'hourly_data': generate_fujing_de_data(date)
        }
    elif 'åŒ—äº¬' in location:
        return {
            'date': date,
            'location': location,
            'hourly_data': generate_beijing_data(date)
        }
    else:
        return {
            'date': date,
            'location': location,
            'hourly_data': generate_default_weather_data(date)
        }

def generate_fujing_de_data(date: datetime) -> List[Dict[str, Any]]:
    """ç”Ÿæˆå»ºå¾·å¸‚å¤©æ°”æ•°æ®"""
    # æ¨¡æ‹Ÿå»ºå¾·å¸‚11æœˆ6æ—¥çš„å¤©æ°”æ•°æ®
    base_temp = 20.0
    base_pressure = 1012

    hourly_data = []
    for hour in range(24):
        hour_dt = date.replace(hour=hour, minute=0, second=0)

        # æ¸©åº¦å˜åŒ–è§„å¾‹
        if 6 <= hour <= 8:  # æ—©ä¸Šç¨å‡‰
            temp = base_temp - 2.5
        elif 12 <= hour <= 14:  # ä¸­åˆæœ€çƒ­
            temp = base_temp + 3.5
        elif 18 <= hour <= 20:  # å‚æ™šé™æ¸©
            temp = base_temp - 1.0
        else:
            temp = base_temp + (hour - 24) * 0.5

        # æ°”å‹å˜åŒ–ï¼ˆæ¨¡æ‹Ÿé£æš´å‰çš„æ°”å‹ä¸‹é™ï¼‰
        if hour < 12:
            pressure = base_pressure + (12 - hour) * 0.5
        else:
            pressure = base_pressure - (hour - 12) * 0.3

        # æ¹¿åº¦å˜åŒ–
        humidity = 65 + math.sin(hour * math.pi / 12) * 10
        humidity = max(30, min(95, humidity))

        # é£é€Ÿå˜åŒ–
        wind_speed = 3.0 + math.cos(hour * math.pi / 6) * 2
        wind_speed = max(0.5, wind_speed)

        # å¤©æ°”çŠ¶å†µ
        if hour < 12:
            condition = 'å¤šäº‘'
        elif hour < 18:
            condition = 'é˜´å¤©'
        else:
            condition = 'æ™´é—´å¤šäº‘'

        hourly_data.append({
            'timestamp': hour_dt,
            'temperature': round(temp, 1),
            'condition': condition,
            'wind_speed': round(wind_speed, 1),
            'pressure': round(pressure, 1),
            'humidity': round(humidity, 1)
        })

    return hourly_data

def generate_beijing_data(date: datetime) -> List[Dict[str, Any]]:
    """ç”ŸæˆåŒ—äº¬å¤©æ°”æ•°æ®"""
    # æ¨¡æ‹ŸåŒ—äº¬11æœˆ6æ—¥çš„å¤©æ°”æ•°æ®
    base_temp = 18.0
    base_pressure = 1018

    hourly_data = []
    for hour in range(24):
        hour_dt = date.replace(hour=hour, minute=0, second=0)

        # åŒ—äº¬æ°”æ¸©ç‰¹å¾ï¼ˆå¹³åŸåœ°åŒºï¼‰
        temp_variation = 5 * (1 - abs(hour - 14) / 10) * math.cos(hour * math.pi / 12)
        temperature = base_temp + temp_variation

        # æ°”å‹å˜åŒ–
        pressure = base_pressure + math.sin(hour * math.pi / 12) * 3

        # æ¹¿åº¦å˜åŒ–
        humidity = 55 + 20 * math.sin(hour * math.pi / 12)

        # é£é€Ÿå˜åŒ–
        wind_speed = 4.0 + 2 * math.cos(hour * math.pi / 6)
        wind_speed = max(1.0, wind_speed)

        # å¤©æ°”çŠ¶å†µ
        if 7 <= hour <= 10:
            condition = 'æ™´'
        elif 11 <= hour <= 16:
            condition = 'æ™´'
        elif 17 <= hour <= 19:
            condition = 'å¤šäº‘'
        else:
            condition = 'æ™´é—´å¤šäº‘'

        hourly_data.append({
            'timestamp': hour_dt,
            'temperature': round(temperature, 1),
            'condition': condition,
            'wind_speed': round(wind_speed, 1),
            'pressure': round(pressure, 1),
            'humidity': round(humidity, 1)
        })

    return hourly_data

def generate_default_weather_data(date: datetime) -> List[Dict[str, Any]]:
    """ç”Ÿæˆé»˜è®¤å¤©æ°”æ•°æ®"""
    base_temp = 22.0
    base_pressure = 1013

    hourly_data = []
    for hour in range(24):
        hour_dt = date.replace(hour=hour, minute=0, second=0)

        # éšæœºæ¸©åº¦å˜åŒ–
        temperature = base_temp + 3 * math.sin(hour * math.pi / 12) * 3

        # æ°”å‹å˜åŒ–
        pressure = base_pressure + 2 * math.sin(hour * math.pi / 8)

        # æ¹¿åº¦å˜åŒ–
        humidity = 60 + 15 * math.sin(hour * math.pi / 6)

        # é£é€Ÿå˜åŒ–
        wind_speed = 5.0 + 3 * math.cos(hour * math.pi / 6)
        wind_speed = max(1.0, wind_speed)

        # å¤©æ°”çŠ¶å†µ
        weather_conditions = ['æ™´', 'å¤šäº‘', 'é˜´', 'å°é›¨', 'ä¸­é›¨', 'å¤§é›¨', 'é›¾']
        condition = weather_conditions[hour % len(weather_conditions)]

        hourly_data.append({
            'timestamp': hour_dt,
            'temperature': round(temperature, 1),
            'condition': condition,
            'wind_speed': round(wind_speed, 1),
            'pressure': round(pressure, 1),
            'humidity': round(humidity, 1)
        })

    return hourly_data

def extract_hourly_data(weather_data: List[Dict[str, Any]], hour_dt: datetime) -> Dict[str, Any]:
    """æå–æŒ‡å®šå°æ—¶çš„æ•°æ®"""
    # æ‰¾åˆ°å¯¹åº”å°æ—¶çš„æ•°æ®
    target_hour = hour_dt.hour

    for data in weather_data:
        if data['timestamp'].hour == target_hour:
            return {
                'temperature': data['temperature'],
                'condition': data['condition'],
                'wind_speed': data['wind_speed'],
                'pressure': data['pressure'],
                'humidity': data['humidity'],
                'historical_data': weather_data  # ä¼ é€’å®Œæ•´å†å²æ•°æ®
            }

    # å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›é»˜è®¤å€¼
    return {
        'temperature': 20.0,
        'condition': 'å¤šäº‘',
        'wind_speed': 5.0,
        'pressure': 1013,
        'humidity': 60,
        'historical_data': []
    }

def format_time(hour: int) -> str:
    """æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º"""
    if 0 <= hour <= 6:
        return "ğŸŒ… æ¸…æ™¨"
    elif 7 <= hour <= 11:
        return "ğŸŒ ä¸Šåˆ"
    elif 12 <= hour <= 14:
        return "ğŸŒ ä¸­åˆ"
    elif 15 <= hour <= 17:
        return "ğŸŒ‡ ä¸‹åˆ"
    elif 18 <= hour <= 21:
        return "ğŸŒ† å‚æ™š"
    else:
        return "ğŸŒ™ å¤œé—´"

def get_rating_emoji(score: float) -> str:
    """è·å–è¯„åˆ†å¯¹åº”çš„è¡¨æƒ…ç¬¦å·"""
    if score >= 95:
        return "ğŸ† å®Œç¾"
    elif score >= 90:
        return "ğŸŒŸ ä¼˜ç§€"
    elif score >= 80:
        return "ğŸ‘ è‰¯å¥½"
    elif score >= 70:
        return "ğŸ‘Œ ä¸€èˆ¬"
    elif score >= 60:
        return "ğŸ˜ è¾ƒå·®"
    else:
        return "âŒ æå·®"

def generate_fishing_suggestions(recommendations: List[Dict[str, Any]]) -> List[str]:
    """ç”Ÿæˆé’“é±¼å»ºè®®"""
    suggestions = []

    for rec in recommendations[:3]:
        score = rec['score']
        conditions = rec['conditions']

        # åŸºäºè¯„åˆ†ç”Ÿæˆå»ºè®®
        if score >= 90:
            suggestion = f"ğŸ¯ {format_time(rec['hour'])}æ˜¯æä½³çš„é’“é±¼æ—¶æœºï¼é±¼ç±»æ´»è·ƒï¼Œé…åˆ{conditions['condition']}å¤©æ°”ï¼Œ"
            if conditions['temperature'] < 20:
                suggestion += "æ¸©åº¦ç¨ä½ï¼Œå»ºè®®å¤šå¤‡è¡£ç‰©ã€‚"
            suggestion += "å»ºè®®æºå¸¦{conditions['wind_speed']:.1f}km/hä»¥å†…çš„é’“å…·ã€‚"
        elif score >= 80:
            suggestion = f"ğŸ‘ {format_time(rec['hour'])æ˜¯ä¸é”™çš„é’“é±¼æ—¶æœºã€‚{conditions['condition']}å¤©æ°”ï¼Œ"
            suggestion += f"{conditions['temperature']:.1f}Â°Cæ¯”è¾ƒé€‚åˆé’“é±¼ï¼Œ"
            suggestion += "å»ºè®®è½»é‡åŒ–è£…å¤‡ï¼Œå‡†å¤‡å¤šç§é’“é¥µã€‚"
        elif score >= 70:
            suggestion = f"ğŸ‘Œ {format_time(rec['hour'])å¯ä»¥è¿›è¡Œé’“é±¼ã€‚{conditions['condition']}å¤©æ°”ï¼Œ"
            suggestion += f"{conditions['temperature']:.1f}Â°Cå°šå¯æ¥å—ï¼Œ"
            suggestion += "å»ºè®®é€‰æ‹©åˆé€‚çš„é’“ç‚¹å’Œé’“æ³•ã€‚"
        else:
            suggestion = f"ğŸ˜ {format_time(rec['hour')}é’“é±¼æ¡ä»¶è¾ƒå·®ã€‚å»ºè®®è€ƒè™‘å…¶ä»–æ—¶é—´æˆ–åœ°ç‚¹ã€‚"

        suggestions.append(suggestion)

    return suggestions

if __name__main__":
    # ç¤ºä¾‹ï¼šåˆ†æå»ºå¾·å¸‚2025å¹´11æœˆ6æ—¥çš„é’“é±¼æ¨è
    generate_fishing_recommendation("å»ºå¾·å¸‚", "2025-11-06")
```

### 6.4 ç”¨æˆ·ä½¿ç”¨æŒ‡å—

#### 6.4.1 è¯„åˆ†è§£è¯»æŒ‡å—

**è¯„åˆ†èŒƒå›´è§£è¯»**ï¼š
- **95+åˆ†**ï¼šğŸ† å®Œç¾ - ç†æƒ³çš„é’“é±¼æ—¶æœº
- **90-94åˆ†**ï¼šğŸŒŸ ä¼˜ç§€ - å¾ˆå¥½çš„é’“é±¼æ¡ä»¶
- **80-89åˆ†**ï¼šğŸ‘ è‰¯å¥½ - é€‚åˆé’“é±¼
- **70-79åˆ†**ï¼šğŸ‘Œ ä¸€èˆ¬ - å¯ä»¥è€ƒè™‘
- **60-69åˆ†**ï¼šğŸ˜ è¾ƒå·® - ä¸æ¨è

**æ–°å¢å› å­å«ä¹‰**ï¼š
- **æ°”å‹è¯„åˆ†**ï¼š
  - 115åˆ†ï¼šæ°”å‹å¿«é€Ÿä¸‹é™ï¼ˆé’“é±¼é»„é‡‘æœŸï¼‰
  - 100åˆ†ï¼šæœ€ä½³æ°”å‹èŒƒå›´
  - 70åˆ†ï¼šé«˜æ°”å‹ç³»ç»Ÿ
  - 65åˆ†ï¼šæé«˜æ°”å‹ç³»ç»Ÿ

- **æ¹¿åº¦è¯„åˆ†**ï¼š
  - 100åˆ†ï¼šç†æƒ³æ¹¿åº¦
  - 95åˆ†ï¼šé«˜æ¹¿åº¦ï¼ˆä½æ°”å‹ä¿¡å·ï¼‰
  - 65åˆ†ï¼šæç«¯æ¹¿åº¦

- **å­£èŠ‚æ€§è¯„åˆ†**ï¼š
  - 100åˆ†ï¼šæœ€ä½³æ—¶æ®µ
  - æ ¹æ®å­£èŠ‚é€‰æ‹©æœ€ä½³æ—¶é—´

- **æœˆç›¸è¯„åˆ†**ï¼š
  - 90åˆ†ï¼šæ»¡æœˆå¤œé—´ï¼ˆå¤œé—´æä½³ï¼‰
  - 85åˆ†ï¼šæ–°æœˆã€å¨¥çœ‰æœˆï¼ˆæ¸ä½³ï¼‰
  - 65åˆ†ï¼šæ»¡æœˆç™½å¤©ï¼ˆç™½å¤©ä¸€èˆ¬ï¼‰

#### 6.4.2 å†³ç­–å»ºè®®

**åŸºäºè¯„åˆ†çš„å†³ç­–ç­–ç•¥**ï¼š
1. **95åˆ†ä»¥ä¸Š**ï¼šç«‹å³å‡ºå‘ï¼Œå‡†å¤‡å……åˆ†è£…å¤‡
2. **90-94åˆ†**ï¼šå¼ºçƒˆæ¨èï¼Œå‡†å¤‡åŸºæœ¬è£…å¤‡
3. **80-89åˆ†**ï¼šå¯ä»¥è€ƒè™‘ï¼Œæ ¹æ®å…·ä½“æƒ…å†µå†³å®š
4. **70-79åˆ†**ï¼šè°¨æ…è€ƒè™‘ï¼Œå¯èƒ½éœ€è¦å…¶ä»–é€‰æ‹©
5. **70åˆ†ä»¥ä¸‹**ï¼šå»ºè®®é€‰æ‹©å…¶ä»–æ—¶é—´æˆ–åœ°ç‚¹

**ç»“åˆå®é™…æƒ…å†µè°ƒæ•´**ï¼š
- **ä¸ªäººç»éªŒ**ï¼šæ ¹æ®å½“åœ°é±¼ç±»ä¹ æ€§è°ƒæ•´è¯„åˆ†æ ‡å‡†
- **è£…å¤‡æ°´å¹³**ï¼šæ ¹æ®é’“å…·å’Œç»éªŒæ°´å¹³è°ƒæ•´æœŸæœ›å€¼
- **å®‰å…¨æ€§**ï¼šå¤©æ°”æ¶åŠ£æ—¶ä¼˜å…ˆè€ƒè™‘å®‰å…¨è€Œéè¯„åˆ†

---

*æ–‡æ¡£åˆ›å»ºå®Œæˆï¼ŒåŒ…å«å®Œæ•´çš„æƒé‡ç®—æ³•è¯´æ˜ã€ä»£ç ç¤ºä¾‹å’Œå®é™…åº”ç”¨æŒ‡å—ã€‚*