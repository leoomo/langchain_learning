# Project Context

## Purpose
LangChain学习项目，专注于探索和实现现代LLM应用，包含实时天气API集成和基于7因子增强评分算法的智能钓鱼推荐系统。

## Tech Stack
- Python 3.11+
- LangChain 1.0+
- OpenAI & Anthropic API
- 彩云天气API v2.6
- asyncio, aiohttp
- SQLite数据库
- OpenSpec规范驱动开发
- 增强钓鱼评分器 (Enhanced Fishing Scorer)

## Project Conventions

### Code Style
- 遵循 PEP 8 代码风格
- 使用 Python 3.11+ 语法和类型注解
- 添加适当的文档字符串和注释
- 使用 uv 包管理器进行依赖管理

### Architecture Patterns
- 模块化设计：清晰的服务分层架构
- 接口统一：统一的服务接口设计
- 依赖注入：松耦合的依赖注入机制
- 缓存优化：多级缓存系统（内存+文件+数据库）
- 双模式兼容：支持传统3因子和增强7因子评分算法

### Testing Strategy
- 单元测试覆盖率 > 80%，关键组件 > 90%
- 集成测试覆盖主要工作流程
- 性能测试验证响应时间和并发支持
- 使用环境变量控制测试模式和调试输出

### Git Workflow
- 使用功能分支开发 (feature/)
- 提交信息使用中文，格式：`type: description`
- 确保所有测试通过后再提交
- 使用 OpenSpec 进行规范驱动开发

## Domain Context

### 钓鱼推荐系统专业背景
- 基于7因子评分算法：温度、天气、风力、气压、湿度、季节性、月相
- 解决传统"86分问题"，提供更好的评分区分度
- 气压趋势分析：下降气压为钓鱼黄金期
- 季节性规律：春季早晚最佳，夏季避开高温
- 月相影响：满月夜间活跃，新月温和天气
- 科学权重分配：温度26.3%、天气21.1%、风力15.8%、气压15.8%、湿度10.5%、季节5.3%、月相5.3%

### 全国地理覆盖
- 支持3,142+中国行政区划（95%+覆盖率）
- 三级坐标查询策略：本地数据库 → 高德API → 降级逻辑
- 智能地名匹配系统，支持100+地区别名
- 多级缓存系统，缓存命中率90%+

## Important Constraints

### 性能要求
- 平均响应时间 < 5秒，95%分位 < 10秒
- 单次评分计算 < 10ms
- 支持多用户并发查询
- 缓存查询响应时间 < 1ms

### 兼容性要求
- 100%向后兼容，保持所有现有接口不变
- 双模式评分系统，支持渐进式部署
- 支持环境变量控制功能开关

### 数据质量
- 实时天气数据，支持历史趋势分析
- 完善的错误处理和重试机制
- 智能降级确保服务可用性

## External Dependencies

### 必需依赖
- **彩云天气API**: 提供实时天气预报数据
- **高德地图API**: 提供地理坐标查询服务
- **SQLite数据库**: 存储行政区划数据和缓存信息

### 可选依赖
- **智谱AI GLM-4.6**: 主要LLM服务提供商
- **Anthropic Claude**: 备用LLM服务
- **OpenAI GPT**: 备用LLM服务

### 技术框架
- **LangChain 1.0+**: LLM应用开发框架
- **uv**: Python包管理器
- **asyncio**: 异步编程支持
- **aiohttp**: 异步HTTP客户端
