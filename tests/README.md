# æµ‹è¯•ç›®å½•ç»“æ„è¯´æ˜

æœ¬ç›®å½•åŒ…å«äº† LangChain æ™ºèƒ½ä½“é¡¹ç›®çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ŒæŒ‰ç…§æµ‹è¯•ç±»å‹å’ŒåŠŸèƒ½è¿›è¡Œäº†åˆ†ç±»ç»„ç»‡ã€‚

## ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ README.md                 # æœ¬è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ test_national_coverage.py # å…¨å›½è¦†ç›–æµ‹è¯•è„šæœ¬
â”œâ”€â”€ unit/                     # å•å…ƒæµ‹è¯•
â”œâ”€â”€ integration/              # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ verify_national_integration.py  # é›†æˆéªŒè¯è„šæœ¬
â”œâ”€â”€ demos/                    # æ¼”ç¤ºè„šæœ¬
â””â”€â”€ weather/                  # å¤©æ°”åŠŸèƒ½ä¸“é¡¹æµ‹è¯•
```

## å„ç›®å½•è¯¦ç»†è¯´æ˜

### unit/ - å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•é’ˆå¯¹å•ä¸ªæ¨¡å—æˆ–ç»„ä»¶è¿›è¡Œç‹¬ç«‹æµ‹è¯•ï¼Œç¡®ä¿å„ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½æ­£ç¡®æ€§ã€‚

**æ–‡ä»¶åˆ—è¡¨ï¼š**
- `test_weather_service.py` - å¤©æ°”æœåŠ¡æ¨¡å—çš„å•å…ƒæµ‹è¯•ï¼ˆ15ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- `test_agent_structure.py` - LangChain æ™ºèƒ½ä½“ä»£ç ç»“æ„éªŒè¯
- `test_weather_component_only.py` - å¤©æ°”ç»„ä»¶ç‹¬ç«‹åŠŸèƒ½æµ‹è¯•
- `final_weather_component_test.py` - æœ€ç»ˆå¤©æ°”ç»„ä»¶éªŒè¯æµ‹è¯•

**è¿è¡Œæ–¹å¼ï¼š**
```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
uv run python -m pytest tests/unit/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
uv run python tests/unit/test_weather_service.py
```

### integration/ - é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•éªŒè¯å¤šä¸ªç»„ä»¶ååŒå·¥ä½œæ—¶çš„æ­£ç¡®æ€§ï¼Œæµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚

**æ–‡ä»¶åˆ—è¡¨ï¼š**
- `test_integrated_weather_agent.py` - æ™ºèƒ½ä½“å¤©æ°”æŸ¥è¯¢åŠŸèƒ½é›†æˆæµ‹è¯•
- `test_agent_conversation.py` - æ™ºèƒ½ä½“å¯¹è¯åŠŸèƒ½æµ‹è¯•
- `test_agent_weather_simulation.py` - æ¨¡æ‹Ÿæ™ºèƒ½ä½“å¤©æ°”æŸ¥è¯¢æµ‹è¯•
- `test_enhanced_weather_national_coverage.py` - å¢å¼ºå¤©æ°”å…¨å›½è¦†ç›–æµ‹è¯•
- `verify_national_integration.py` - é›†æˆéªŒè¯è„šæœ¬

**è¿è¡Œæ–¹å¼ï¼š**
```bash
# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
uv run python -m pytest tests/integration/ -v

# è¿è¡Œç‰¹å®šé›†æˆæµ‹è¯•
uv run python tests/integration/test_integrated_weather_agent.py
```

### demos/ - æ¼”ç¤ºè„šæœ¬

æ¼”ç¤ºè„šæœ¬å±•ç¤ºé¡¹ç›®çš„å„é¡¹åŠŸèƒ½ï¼Œç”¨äºåŠŸèƒ½éªŒè¯å’Œæ¼”ç¤ºã€‚

**æ–‡ä»¶åˆ—è¡¨ï¼š**
- `demo_weather_agent.py` - æ™ºèƒ½ä½“å¤©æ°”æŸ¥è¯¢æ¼”ç¤º
- `weather_example.py` - å½©äº‘å¤©æ°” API ä½¿ç”¨ç¤ºä¾‹

**è¿è¡Œæ–¹å¼ï¼š**
```bash
# è¿è¡Œå¤©æ°”æŸ¥è¯¢æ¼”ç¤º
uv run python tests/demos/demo_weather_agent.py

# è¿è¡Œå¤©æ°” API ç¤ºä¾‹
uv run python tests/demos/weather_example.py
```

### weather/ - å¤©æ°”åŠŸèƒ½ä¸“é¡¹æµ‹è¯•

ä¸“é—¨é’ˆå¯¹å¤©æ°”åŠŸèƒ½çš„è¯¦ç»†æµ‹è¯•ï¼ŒåŒ…æ‹¬çœŸå® API è°ƒç”¨æµ‹è¯•ã€‚

**æ–‡ä»¶åˆ—è¡¨ï¼š**
- `test_real_weather_api.py` - å½©äº‘å¤©æ°” API çœŸå®åœºæ™¯æµ‹è¯•

**è¿è¡Œæ–¹å¼ï¼š**
```bash
# è¿è¡Œå¤©æ°” API çœŸå®æµ‹è¯•
uv run python tests/weather/test_real_weather_api.py
```

## ç¯å¢ƒé…ç½®

è¿è¡Œæµ‹è¯•å‰éœ€è¦ç¡®ä¿å·²æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡ï¼š

1. **å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š**
   ```bash
   cp .env.example .env
   ```

2. **é…ç½®å¿…è¦çš„ API å¯†é’¥ï¼š**
   - `CAIYUN_API_KEY` - å½©äº‘å¤©æ°” API å¯†é’¥ï¼ˆå¿…éœ€ï¼Œç”¨äºçœŸå®å¤©æ°”æ•°æ®ï¼‰
   - `ANTHROPIC_AUTH_TOKEN` - æ™ºè°± AI API å¯†é’¥ï¼ˆæ™ºèƒ½ä½“åŠŸèƒ½ï¼‰
   - `ANTHROPIC_API_KEY` - Anthropic Claude API å¯†é’¥ï¼ˆå¤‡é€‰ï¼‰
   - `OPENAI_API_KEY` - OpenAI GPT API å¯†é’¥ï¼ˆå¤‡é€‰ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# ä½¿ç”¨ pytest è¿è¡Œæ‰€æœ‰æµ‹è¯•
uv run python -m pytest tests/ -v

# æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿçš„ unittest æ–¹å¼
uv run python -m unittest discover tests/ -v
```

### 2. è¿è¡Œç‰¹å®šç±»å‹çš„æµ‹è¯•
```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
uv run python -m pytest tests/unit/ -v

# åªè¿è¡Œé›†æˆæµ‹è¯•
uv run python -m pytest tests/integration/ -v

# è¿è¡Œå¤©æ°”ç›¸å…³æµ‹è¯•
uv run python -m pytest tests/weather/ tests/unit/test_weather_service.py -v
```

### 3. è¿è¡ŒåŠŸèƒ½æ¼”ç¤º
```bash
# å¤©æ°”æŸ¥è¯¢å®Œæ•´æ¼”ç¤º
uv run python tests/demos/demo_weather_agent.py

# å¤©æ°” API ä½¿ç”¨ç¤ºä¾‹
uv run python tests/demos/weather_example.py
```

## æµ‹è¯•è¦†ç›–èŒƒå›´

### âœ… å·²è¦†ç›–çš„åŠŸèƒ½

1. **å¤©æ°”æœåŠ¡æ¨¡å—**
   - API è°ƒç”¨æˆåŠŸ/å¤±è´¥åœºæ™¯
   - æ•°æ®è§£æå’Œæ ¼å¼åŒ–
   - é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶
   - åŸå¸‚åæ ‡è·å–

2. **æ™ºèƒ½ä½“ç»„ä»¶**
   - å·¥å…·å®šä¹‰å’Œæ³¨å†Œ
   - æ¨¡å‹åˆå§‹åŒ–
   - æ¶ˆæ¯å¤„ç†æµç¨‹

3. **é›†æˆåŠŸèƒ½**
   - æ™ºèƒ½ä½“ä¸å¤©æ°”å·¥å…·çš„é›†æˆ
   - å®Œæ•´çš„æŸ¥è¯¢æµç¨‹
   - å¹¶å‘è°ƒç”¨å¤„ç†

4. **API é›†æˆ**
   - çœŸå®å½©äº‘å¤©æ°” API è°ƒç”¨
   - æ•°æ®å‡†ç¡®æ€§éªŒè¯
   - æ€§èƒ½æµ‹è¯•

### ğŸ“Š æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•æ–‡ä»¶æ•°ï¼š** 10 ä¸ª
- **å•å…ƒæµ‹è¯•ï¼š** 4 ä¸ªæ–‡ä»¶
- **é›†æˆæµ‹è¯•ï¼š** 3 ä¸ªæ–‡ä»¶
- **æ¼”ç¤ºè„šæœ¬ï¼š** 2 ä¸ªæ–‡ä»¶
- **ä¸“é¡¹æµ‹è¯•ï¼š** 1 ä¸ªæ–‡ä»¶

## æ³¨æ„äº‹é¡¹

1. **API å¯†é’¥é…ç½®ï¼š** çœŸå® API æµ‹è¯•éœ€è¦æœ‰æ•ˆçš„å½©äº‘å¤©æ°” API å¯†é’¥
2. **ç½‘ç»œè¿æ¥ï¼š** éƒ¨åˆ†æµ‹è¯•éœ€è¦äº’è”ç½‘è¿æ¥æ¥è°ƒç”¨å¤©æ°” API
3. **Python è·¯å¾„ï¼š** æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²è‡ªåŠ¨é…ç½®é¡¹ç›®æ ¹ç›®å½•åˆ° Python è·¯å¾„
4. **ä¾èµ–ç®¡ç†ï¼š** ä½¿ç”¨ `uv` ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¼å…¥é”™è¯¯ï¼š**
   ```bash
   # ç¡®ä¿ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæµ‹è¯•
   uv run python tests/unit/test_weather_service.py
   ```

2. **API å¯†é’¥é”™è¯¯ï¼š**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
   uv run python -c "import os; from dotenv import load_dotenv; load_dotenv(); print(os.getenv('CAIYUN_API_KEY'))"
   ```

3. **ç½‘ç»œè¿æ¥é—®é¢˜ï¼š**
   - ç¡®ä¿èƒ½å¤Ÿè®¿é—®å½©äº‘å¤©æ°” API (https://api.caiyunapp.com)
   - æ£€æŸ¥é˜²ç«å¢™å’Œç½‘ç»œé…ç½®

### è°ƒè¯•å»ºè®®

1. **ä½¿ç”¨è¯¦ç»†è¾“å‡ºï¼š**
   ```bash
   uv run python -m pytest tests/ -v -s
   ```

2. **è¿è¡Œå•ä¸ªæµ‹è¯•ï¼š**
   ```bash
   uv run python -m pytest tests/unit/test_weather_service.py::TestWeatherService::test_get_coordinates_success -v
   ```

3. **æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼š**
   ```bash
   uv run python -m pytest tests/ --cov=. --cov-report=html
   ```

## è´¡çŒ®æŒ‡å—

æ·»åŠ æ–°æµ‹è¯•æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹è§„èŒƒï¼š

1. **æ–‡ä»¶å‘½åï¼š** ä½¿ç”¨ `test_` å‰ç¼€
2. **æµ‹è¯•åˆ†ç±»ï¼š** æ ¹æ®æµ‹è¯•ç±»å‹æ”¾ç½®åˆ°å¯¹åº”ç›®å½•
3. **å¯¼å…¥è·¯å¾„ï¼š** ä½¿ç”¨æ ‡å‡†çš„è·¯å¾„é…ç½®ä»£ç 
4. **æ–‡æ¡£è¯´æ˜ï¼š** ä¸ºå¤æ‚æµ‹è¯•æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²

---

**æ›´æ–°æ—¶é—´ï¼š** 2025-11-03
**ç»´æŠ¤è€…ï¼š** LangChain å­¦ä¹ é¡¹ç›®